<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>第 3 章 容器图形化管理界面</title><link rel="stylesheet" type="text/css" href="../docbook.css" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><meta name="keywords" content="qmeu,kvm,xen,openvz, docker, coreos, , " /><link rel="home" href="../index.html" title="Netkiller Virtualization 手札" /><link rel="up" href="../index.html" title="Netkiller Virtualization 手札" /><link rel="prev" href="../kubernetes/ch02s07.html" title="2.7. Kubeapps" /><link rel="next" href="rancher.html" title="3.2. Rancher - Multi-Cluster Kubernetes Management" /></head><body><a xmlns="" href="//www.netkiller.cn/">Home</a> |
		<a xmlns="" href="//netkiller.github.io/">简体中文</a> |
	    <a xmlns="" href="http://netkiller.sourceforge.net/">繁体中文</a> |
	    <a xmlns="" href="/journal/index.html">杂文</a> |
	    <a xmlns="" href="https://zhuanlan.zhihu.com/netkiller">知乎专栏</a> |
   	    <a xmlns="" href="https://edu.51cto.com/lecturer/1703915.html">51CTO学院</a> |
	    <a xmlns="" href="https://edu.csdn.net/lecturer/6423">CSDN程序员研修院</a> |
	    <a xmlns="" href="https://github.com/netkiller">Github</a> |
	    <a xmlns="" href="http://my.oschina.net/neochen/">OSChina 博客</a> |
	    <a xmlns="" href="https://cloud.tencent.com/developer/column/2078">腾讯云社区</a> |
	    <a xmlns="" href="https://yq.aliyun.com/u/netkiller/">阿里云栖社区</a> |
	    <a xmlns="" href="https://www.facebook.com/bg7nyt">Facebook</a> |
	    <a xmlns="" href="http://cn.linkedin.com/in/netkiller/">Linkedin</a> |
	    <a xmlns="" href="//www.netkiller.cn/home/donations.html">打赏(Donations)</a> |
	    <a xmlns="" href="//www.netkiller.cn/home/about.html">About</a><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">第 3 章 容器图形化管理界面</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="../kubernetes/ch02s07.html">上一页</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="rancher.html">下一页</a></td></tr></table><hr /></div><table xmlns=""><tr><td><iframe src="//ghbtns.com/github-btn.html?user=netkiller&amp;repo=netkiller.github.io&amp;type=watch&amp;count=true&amp;size=large" height="30" width="170" frameborder="0" scrolling="0" style="width:170px; height: 30px;" allowTransparency="true"></iframe></td><td><iframe src="//ghbtns.com/github-btn.html?user=netkiller&amp;repo=netkiller.github.io&amp;type=fork&amp;count=true&amp;size=large" height="30" width="170" frameborder="0" scrolling="0" style="width:170px; height: 30px;" allowTransparency="true"></iframe></td><td><iframe src="//ghbtns.com/github-btn.html?user=netkiller&amp;type=follow&amp;count=true&amp;size=large" height="30" width="240" frameborder="0" scrolling="0" style="width:240px; height: 30px;" allowTransparency="true"></iframe></td><td></td><td><a href="https://zhuanlan.zhihu.com/netkiller"><img src="/images/logo/zhihu-card-default.svg" height="25" /></a></td><td valign="middle"><a href="https://zhuanlan.zhihu.com/netkiller">知乎专栏</a> ｜ <a href="https://www.zhihu.com/club/1241768772601950208">多维度架构</a></td><td></td><td></td><td></td><td></td></tr></table><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="index"></a>第 3 章 容器图形化管理界面</h1></div></div></div><div class="toc"><p><strong>目录</strong></p><dl class="toc"><dt><span class="section"><a href="index.html#idm318517989840">3.1. Portainer</a></span></dt><dd><dl><dt><span class="section"><a href="index.html#idm318517988400">3.1.1. 安装</a></span></dt><dt><span class="section"><a href="index.html#idm318517983376">3.1.2. 配置 Portainer</a></span></dt><dt><span class="section"><a href="index.html#idm318517983120">3.1.3. 添加代理出错</a></span></dt></dl></dd><dt><span class="section"><a href="rancher.html">3.2. Rancher - Multi-Cluster Kubernetes Management</a></span></dt><dd><dl><dt><span class="section"><a href="rancher.html#idm318517960640">3.2.1. 安装</a></span></dt><dd><dl><dt><span class="section"><a href="rancher.html#idm318517952928">3.2.1.1. Ubuntu</a></span></dt><dt><span class="section"><a href="rancher.html#idm318517951584">3.2.1.2. SSL 证书</a></span></dt><dt><span class="section"><a href="rancher.html#idm318517948656">3.2.1.3. 进入容器</a></span></dt><dt><span class="section"><a href="rancher.html#idm318517947328">3.2.1.4. Rancher CLI</a></span></dt><dt><span class="section"><a href="rancher.html#rancher-compose">3.2.1.5. rancher-compose</a></span></dt></dl></dd><dt><span class="section"><a href="rancher.html#idm318517943840">3.2.2. 快速入门</a></span></dt><dd><dl><dt><span class="section"><a href="rancher.html#idm318517937008">3.2.2.1. API</a></span></dt></dl></dd><dt><span class="section"><a href="rancher.html#idm318517929936">3.2.3. Rancher CLI</a></span></dt><dd><dl><dt><span class="section"><a href="rancher.html#idm318517928752">3.2.3.1. 登陆 Rancher</a></span></dt><dt><span class="section"><a href="rancher.html#idm318517926416">3.2.3.2. 查看集群</a></span></dt><dt><span class="section"><a href="rancher.html#idm318517924832">3.2.3.3. 查看节点</a></span></dt><dt><span class="section"><a href="rancher.html#idm318517923424">3.2.3.4. catalog</a></span></dt><dt><span class="section"><a href="rancher.html#idm318517921840">3.2.3.5. 查看设置</a></span></dt></dl></dd><dt><span class="section"><a href="rancher.html#idm318517920688">3.2.4. Rancher Compose</a></span></dt><dd><dl><dt><span class="section"><a href="rancher.html#idm318517918928">3.2.4.1. Rancher Compose 命令</a></span></dt><dt><span class="section"><a href="rancher.html#idm318517918672">3.2.4.2. 操作演示</a></span></dt></dl></dd><dt><span class="section"><a href="rancher.html#idm318517909040">3.2.5. Rancher Kubernetes Engine (RKE)</a></span></dt><dt><span class="section"><a href="rancher.html#rancher.cli">3.2.6. Rancher CLI</a></span></dt><dt><span class="section"><a href="rancher.html#idm318517903824">3.2.7. 调试</a></span></dt><dt><span class="section"><a href="rancher.html#idm318517902144">3.2.8. FAQ</a></span></dt><dd><dl><dt><span class="section"><a href="rancher.html#idm318517901424">3.2.8.1.  [network] Host [rancher.netkiller.cn] is not able to connect to the following ports: [rancher.netkiller.cn:2379]. Please check network policies and firewall rules</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="helm.html">3.3. Helm - The package manager for Kubernetes</a></span></dt><dd><dl><dt><span class="section"><a href="helm.html#helm.setup">3.3.1. 安装 Helm</a></span></dt><dd><dl><dt><span class="section"><a href="helm.html#idm318517894496">3.3.1.1. Ubuntu</a></span></dt><dt><span class="section"><a href="helm.html#idm318517893008">3.3.1.2. Mac</a></span></dt></dl></dd><dt><span class="section"><a href="helm.html#idm318517890176">3.3.2. 快速开始</a></span></dt><dt><span class="section"><a href="helm.html#helm.command">3.3.3. Helm 命令</a></span></dt><dd><dl><dt><span class="section"><a href="helm.html#idm318517887248">3.3.3.1. 初始化 Helm</a></span></dt><dt><span class="section"><a href="helm.html#idm318517886144">3.3.3.2. 查看仓库列表</a></span></dt><dt><span class="section"><a href="helm.html#idm318517882432">3.3.3.3. 搜索</a></span></dt><dt><span class="section"><a href="helm.html#idm318517880336">3.3.3.4. 查看包信息</a></span></dt><dt><span class="section"><a href="helm.html#idm318517878592">3.3.3.5. 安装</a></span></dt><dt><span class="section"><a href="helm.html#idm318517876928">3.3.3.6. 列表</a></span></dt><dt><span class="section"><a href="helm.html#idm318517875360">3.3.3.7. 删除</a></span></dt><dt><span class="section"><a href="helm.html#idm318517874064">3.3.3.8. 升级</a></span></dt><dt><span class="section"><a href="helm.html#idm318517872832">3.3.3.9. 回滚</a></span></dt><dt><span class="section"><a href="helm.html#idm318517871456">3.3.3.10. 查看状态</a></span></dt></dl></dd><dt><span class="section"><a href="helm.html#idm318517887824">3.3.4. elastic</a></span></dt><dt><span class="section"><a href="helm.html#helm.faq">3.3.5. Helm Faq</a></span></dt></dl></dd></dl></div>
	
	

<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idm318517989840"></a>3.1. Portainer</h2></div></div></div>
	
	<p>Portainer 是一个轻量级的 Docker 管理界面，官方提供了 Demo 演示地址</p>
	<p></p>
	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm318517988400"></a>3.1.1. 安装</h3></div></div></div>
		
		<p>Server 服务器安装</p>
		<pre class="screen">
			
docker volume create portainer_data
docker run -d -p 8000:8000 -p 9000:9000 --name=portainer --restart=always -v /var/run/docker.sock:/var/run/docker.sock -v portainer_data:/data portainer/portainer-ce
			
		</pre>
		<p>Agent 代理安装</p>
		<pre class="screen">
			
docker run -d -p 9001:9001 --name portainer_agent --restart=always -v /var/run/docker.sock:/var/run/docker.sock -v /var/lib/docker/volumes:/var/lib/docker/volumes portainer/agent			
			
		</pre>
		<p>使用 docker-compose 安装</p>
		<pre class="screen">
			
version: '3.9'

services:
  portainer:
    image: portainer/portainer-ce
    container_name: prtainer
    restart: always
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - portainter:/data
    ports:
      - 8000:8000
      - 9000:9000

  portainer-agent:
    image: portainer/agent
    container_name: portainer-agent
    restart: always
    volumes:
        - /var/run/docker.sock:/var/run/docker.sock
        - /var/lib/docker/volumes:/var/lib/docker/volumes
    ports:
        - 9001:9001

volumes:
  portainter:    			
			
		</pre>
		<pre class="screen">
			
第一台管理服务器，启动管理界面：
[root@netkiller portainer]# docker-compose up -d portainer

第二台开发环境服务器，启动代理：
[root@development portainer]# docker-compose up -d portainer-agent

第三台测试环境服务器，启动代理
[root@testing portainer]# docker-compose up -d portainer-agent			
			
		</pre>
	</div>
	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm318517983376"></a>3.1.2. 配置 Portainer</h3></div></div></div>
		
		<p>设置管理员密码，创建用户</p>
		<div><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="800"><tr><td><img src="../images/portainer/Portainer-admin.png" width="800" /></td></tr></table></div>
		<p>当前界面中有三个选项，分别是 Docker（本地 Docker），Kubernetes, Agent(代理)</p>
		<div><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="800"><tr><td><img src="../images/portainer/Portainer-local.png" width="800" /></td></tr></table></div>
		<p>添加本地 Docker，通过 UNIX SOCK 链接，通常是 /var/run/docker.sock</p>
		<div><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="800"><tr><td><img src="../images/portainer/Portainer-local-connect.png" width="800" /></td></tr></table></div>
		<p>点击 Connect 按钮就可以建立链接</p>
		<div><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="800"><tr><td><img src="../images/portainer/Portainer-local-connect-success.png" width="800" /></td></tr></table></div>
		<p>添加代理 Docker，左边菜单点击 Endpoints，然后点击 Add endpoint</p>
		<div><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="800"><tr><td><img src="../images/portainer/Portainer-endpoint.png" width="800" /></td></tr></table></div>
		<p>选择 Agent</p>
		<div><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="800"><tr><td><img src="../images/portainer/Portainer-agent.png" width="800" /></td></tr></table></div>
		<p>Name 给代理起个名气，Endpoint URL 输入代理的IP地址和端口号，Group 是分组（可不选），最后点击 Add endpoint 按钮。</p>
		<div><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="800"><tr><td><img src="../images/portainer/Portainer-agent-addendpoint.png" width="800" /></td></tr></table></div>
		<p>完成代理的添加</p>
		<div><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="800"><tr><td><img src="../images/portainer/Portainer-agent-success.png" width="800" /></td></tr></table></div>
		<p>回到 Home </p>
		<div><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="800"><tr><td><img src="../images/portainer/Portainer-home.png" width="800" /></td></tr></table></div>
	</div>
	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm318517983120"></a>3.1.3. 添加代理出错</h3></div></div></div>
		
		<p>portainer 错误日志</p>
		<pre class="screen">
			
portainer          | 2021/08/04 07:24:14 http error: Unable to initiate communications with endpoint (err=agent already paired with another Portainer instance) (code=500)
portainer          | 2021/08/04 07:25:49 http error: Unable to initiate communications with endpoint (err=agent already paired with another Portainer instance) (code=500)			
			
		</pre>
		<p>agent 日志</p>
		<pre class="screen">
			
portainer-agent    | 2021/08/04 07:25:49 http error: Invalid request signature (err=Unauthorized) (code=403)
portainer-agent    | 2021/08/04 07:25:49 http error: Invalid request signature (err=Unauthorized) (code=403)			
			
		</pre>
		<p>问题出在，重装了 portainer 先前的 agent 已经与之前的 portainer 建立链接。</p>
		<p>解决方法，重装 agent 记得要删除卷。</p>
		<pre class="screen">
			
[root@testing portainer]# docker-compose stop portainer-agent
Stopping portainer-agent ... done

[root@testing portainer]# docker-compose rm -a  portainer-agent
WARNING: --all flag is obsolete. This is now the default behavior of `docker-compose rm`
Going to remove portainer-agent
Are you sure? [yN] y
Removing portainer-agent ... done

[root@testing portainer]# docker volume ls
DRIVER    VOLUME NAME
local     portainer_portainter

[root@testing portainer]# docker volume rm portainer_portainter
portainer_portainter

[root@testing portainer]# docker-compose up -d portainer-agent
Creating volume "portainer_portainter" with default driver
Creating portainer-agent ... done

[root@testing portainer]# docker-compose ps
     Name         Command   State                    Ports                  
----------------------------------------------------------------------------
portainer-agent   ./agent   Up      0.0.0.0:9001-&gt;9001/tcp,:::9001-&gt;9001/tcp	
			
		</pre>
	</div>
</div>
	

	



</div><div xmlns="" id="SOHUCS"></div><script xmlns="" charset="utf-8" type="text/javascript" src="https://cy-cdn.kuaizhan.com/upload/changyan.js"></script><script xmlns="" type="text/javascript">
window.changyan.api.config({
appid: 'cyvwjQUG3',
conf: 'prod_ef966242df3d8b5acb1e0ee9fc01cafe'
});
</script><script xmlns="" type="text/javascript" id="clustrmaps" src="//cdn.clustrmaps.com/map_v2.js?u=r5HG&amp;d=9mi5r_kkDC8uxG8HuY3p4-2qgeeVypAK9vMD-2P6BYM"></script><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="../kubernetes/ch02s07.html">上一页</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="rancher.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">2.7. Kubeapps </td><td width="20%" align="center"><a accesskey="h" href="../index.html">起始页</a></td><td width="40%" align="right" valign="top"> 3.2. Rancher - Multi-Cluster Kubernetes Management</td></tr></table></div><script xmlns="">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-11694057-1', 'auto');
  ga('send', 'pageview');

</script><script xmlns="" async="async">
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?93967759a51cda79e49bf4e34d0b0f2c";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script xmlns="" async="async">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script></body></html>