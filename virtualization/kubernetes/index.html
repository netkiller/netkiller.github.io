<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>ç¬¬Â 2Â ç« Â Kubernetes</title><link rel="stylesheet" type="text/css" href="..//docbook.css" /><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /><meta name="keywords" content="qmeu,kvm,xen,openvz, docker, coreos, , " /><link rel="home" href="../index.html" title="Netkiller Virtualization æ‰‹æœ­" /><link rel="up" href="../index.html" title="Netkiller Virtualization æ‰‹æœ­" /><link rel="prev" href="../docker/docker.faq.html" title="1.10.Â Docker FAQ" /><link rel="next" href="microk8s.html" title="2.2.Â microk8s" /></head><body><a xmlns="" href="//www.netkiller.cn/">Home</a> |
		<a xmlns="" href="//netkiller.github.io/">ç®€ä½“ä¸­æ–‡</a> |
	    <a xmlns="" href="http://netkiller.sourceforge.net/">ç¹ä½“ä¸­æ–‡</a> |
	    <a xmlns="" href="/journal/index.html">æ‚æ–‡</a> |
	    <a xmlns="" href="https://zhuanlan.zhihu.com/netkiller">çŸ¥ä¹ä¸“æ </a> |
	    <a xmlns="" href="https://github.com/netkiller">Github</a> |
	    <a xmlns="" href="http://my.oschina.net/neochen/">OSChina åšå®¢</a> |
	    <a xmlns="" href="https://cloud.tencent.com/developer/column/2078">äº‘ç¤¾åŒº</a> |
	    <a xmlns="" href="https://yq.aliyun.com/u/netkiller/">äº‘æ –ç¤¾åŒº</a> |
	    <a xmlns="" href="https://www.facebook.com/bg7nyt">Facebook</a> |
	    <a xmlns="" href="http://cn.linkedin.com/in/netkiller/">Linkedin</a> |
	    <a xmlns="" href="//www.netkiller.cn/home/video.html">è§†é¢‘æ•™ç¨‹</a> |
	    <a xmlns="" href="//www.netkiller.cn/home/donations.html">æ‰“èµ(Donations)</a> |
	    <a xmlns="" href="//www.netkiller.cn/home/about.html">About</a><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">ç¬¬Â 2Â ç« Â Kubernetes</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="../docker/docker.faq.html">ä¸Šä¸€é¡µ</a>Â </td><th width="60%" align="center">Â </th><td width="20%" align="right">Â <a accesskey="n" href="microk8s.html">ä¸‹ä¸€é¡µ</a></td></tr></table><hr /></div><table xmlns=""><tr><td><iframe src="//ghbtns.com/github-btn.html?user=netkiller&amp;repo=netkiller.github.io&amp;type=watch&amp;count=true&amp;size=large" height="30" width="170" frameborder="0" scrolling="0" style="width:170px; height: 30px;" allowTransparency="true"></iframe></td><td><iframe src="//ghbtns.com/github-btn.html?user=netkiller&amp;repo=netkiller.github.io&amp;type=fork&amp;count=true&amp;size=large" height="30" width="170" frameborder="0" scrolling="0" style="width:170px; height: 30px;" allowTransparency="true"></iframe></td><td><iframe src="//ghbtns.com/github-btn.html?user=netkiller&amp;type=follow&amp;count=true&amp;size=large" height="30" width="240" frameborder="0" scrolling="0" style="width:240px; height: 30px;" allowTransparency="true"></iframe></td><td></td><td><a href="https://zhuanlan.zhihu.com/netkiller"><img src="/images/logo/zhihu-card-default.svg" height="25" /></a></td><td valign="middle"><a href="https://zhuanlan.zhihu.com/netkiller">çŸ¥ä¹ä¸“æ </a> ï½œ <a href="https://www.zhihu.com/club/1241768772601950208">å¤šç»´åº¦æ¶æ„</a></td><td> å¾®ä¿¡å· netkiller-ebook | QQç¾¤ï¼š128659835 è¯·æ³¨æ˜â€œè¯»è€…â€ </td></tr></table><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="index"></a>ç¬¬Â 2Â ç« Â Kubernetes</h1></div></div></div><div class="toc"><p><strong>ç›®å½•</strong></p><dl class="toc"><dt><span class="section"><a href="index.html#minikube">2.1. Minikube</a></span></dt><dd><dl><dt><span class="section"><a href="index.html#minikube.install">2.1.1. CentOS 8 å®‰è£… minikube</a></span></dt><dd><dl><dt><span class="section"><a href="index.html#idp104">2.1.1.1. CentOS</a></span></dt><dd><dl><dt><span class="section"><a href="index.html#idp103">2.1.1.1.1. æ— è™šæ‹Ÿæœº</a></span></dt></dl></dd><dt><span class="section"><a href="index.html#idp105">2.1.1.2. Mac OS</a></span></dt></dl></dd><dt><span class="section"><a href="index.html#minikube.Quickstart">2.1.2. Quickstart</a></span></dt><dt><span class="section"><a href="index.html#minikube.command">2.1.3. minikube å‘½ä»¤</a></span></dt><dd><dl><dt><span class="section"><a href="index.html#minikube.start">2.1.3.1. å¯åŠ¨ minikube</a></span></dt><dd><dl><dt><span class="section"><a href="index.html#idp106">2.1.3.1.1. è™šæ‹Ÿæœºé©±åŠ¨</a></span></dt><dt><span class="section"><a href="index.html#idp107">2.1.3.1.2. å¼€å¯GPU</a></span></dt><dt><span class="section"><a href="index.html#idp108">2.1.3.1.3. æ—¥å¿—è¾“å‡ºçº§åˆ«</a></span></dt><dt><span class="section"><a href="index.html#idp109">2.1.3.1.4. CPU å’Œ å†…å­˜åˆ†é…</a></span></dt><dt><span class="section"><a href="index.html#idp110">2.1.3.1.5. æŒ‡å®š kubernetes ç‰ˆæœ¬</a></span></dt><dt><span class="section"><a href="index.html#idp111">2.1.3.1.6. é…ç½®å¯åŠ¨é¡¹</a></span></dt><dt><span class="section"><a href="index.html#idp112">2.1.3.1.7. æŒ‡å®š registry-mirror é•œåƒ</a></span></dt><dt><span class="section"><a href="index.html#idp113">2.1.3.1.8. æŒ‡å®šä¸‹è½½é•œåƒ</a></span></dt><dt><span class="section"><a href="index.html#idp114">2.1.3.1.9. Enabling Unsafe Sysctls</a></span></dt></dl></dd><dt><span class="section"><a href="index.html#minikube.stop">2.1.3.2. åœæ­¢ minikube</a></span></dt><dt><span class="section"><a href="index.html#idp115">2.1.3.3. Docker ç¯å¢ƒå˜é‡</a></span></dt><dt><span class="section"><a href="index.html#minikube.ssh">2.1.3.4. SSH</a></span></dt><dt><span class="section"><a href="index.html#idp116">2.1.3.5. ç¼“å­˜é•œåƒ</a></span></dt><dt><span class="section"><a href="index.html#idp117">2.1.3.6. æ¸…ç† minikube</a></span></dt><dt><span class="section"><a href="index.html#idp118">2.1.3.7. Kubernetes æ§åˆ¶é¢æ¿</a></span></dt><dt><span class="section"><a href="index.html#idp119">2.1.3.8. service</a></span></dt><dt><span class="section"><a href="index.html#idp120">2.1.3.9. æŸ¥çœ‹æ—¥å¿—</a></span></dt><dt><span class="section"><a href="index.html#idp121">2.1.3.10. æŸ¥çœ‹ Docker ç¯å¢ƒå˜é‡</a></span></dt><dt><span class="section"><a href="index.html#minikube.profile">2.1.3.11. profile</a></span></dt><dt><span class="section"><a href="index.html#minikube.addons">2.1.3.12. addons</a></span></dt><dd><dl><dt><span class="section"><a href="index.html#idp122">2.1.3.12.1. å¯ç”¨ addons</a></span></dt><dt><span class="section"><a href="index.html#idp123">2.1.3.12.2. æŸ¥çœ‹ addons åˆ—è¡¨</a></span></dt></dl></dd><dt><span class="section"><a href="index.html#minikube.ssh">2.1.3.13. SSH</a></span></dt><dt><span class="section"><a href="index.html#minikube.ip">2.1.3.14. æŸ¥çœ‹IPåœ°å€</a></span></dt><dt><span class="section"><a href="index.html#minikube.addons">2.1.3.15. addons</a></span></dt><dd><dl><dt><span class="section"><a href="index.html#idp124">2.1.3.15.1. æŸ¥çœ‹æ‰€æœ‰æ’ä»¶</a></span></dt><dt><span class="section"><a href="index.html#idp125">2.1.3.15.2. å¼€å¯ registry ç§æœ‰åº“</a></span></dt><dt><span class="section"><a href="index.html#idp126">2.1.3.15.3. å¯ç”¨ ingress</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="index.html#minikube.faq">2.1.4. FAQ</a></span></dt><dd><dl><dt><span class="section"><a href="index.html#idp127">2.1.4.1. This computer doesn't have VT-X/AMD-v enabled. Enabling it in the BIOS is mandatory</a></span></dt><dt><span class="section"><a href="index.html#idp128">2.1.4.2. ERROR FileContent--proc-sys-net-bridge-bridge-nf-call-iptables</a></span></dt><dt><span class="section"><a href="index.html#idp129">2.1.4.3. ERROR ImagePull</a></span></dt><dt><span class="section"><a href="index.html#idp130">2.1.4.4. è¯ä¹¦å·²å­˜åœ¨é”™è¯¯</a></span></dt><dt><span class="section"><a href="index.html#idp131">2.1.4.5. http: server gave HTTP response to HTTPS client</a></span></dt><dt><span class="section"><a href="index.html#idp132">2.1.4.6. provided port is not in the valid range. The range of valid ports is 30000-32767</a></span></dt><dt><span class="section"><a href="index.html#idp133">2.1.4.7. Exiting due to MK_ENABLE: run callbacks: running callbacks: [verifying registry addon pods : timed out waiting for the condition: timed out waiting for the condition]</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="microk8s.html">2.2. microk8s</a></span></dt><dd><dl><dt><span class="section"><a href="microk8s.html#idp134">2.2.1. å®‰è£… microk8s</a></span></dt><dt><span class="section"><a href="microk8s.html#idp135">2.2.2. kubectl</a></span></dt><dt><span class="section"><a href="microk8s.html#idp137">2.2.3. Kubernetes Addons</a></span></dt><dd><dl><dt><span class="section"><a href="microk8s.html#idp136">2.2.3.1. dashboard</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="kubectl.html">2.3. kubectl - controls the Kubernetes cluster manager. </a></span></dt><dd><dl><dt><span class="section"><a href="kubectl.html#idp138">2.3.1. å¦‚ä½•ä» docker è¿‡æ¸¡åˆ° kubectl å‘½ä»¤</a></span></dt><dt><span class="section"><a href="kubectl.html#kubectl.info">2.3.2. æŸ¥çœ‹ä¿¡æ¯</a></span></dt><dd><dl><dt><span class="section"><a href="kubectl.html#idp139">2.3.2.1. api-versions</a></span></dt><dt><span class="section"><a href="kubectl.html#get.nodes">2.3.2.2. èŠ‚ç‚¹</a></span></dt><dd><dl><dt><span class="section"><a href="kubectl.html#get.nodes">2.3.2.2.1. nodes</a></span></dt></dl></dd><dt><span class="section"><a href="kubectl.html#get.cs">2.3.2.3. æŸ¥è¯¢é›†ç¾¤çŠ¶æ€</a></span></dt><dt><span class="section"><a href="kubectl.html#kubectl.config">2.3.2.4. config</a></span></dt><dd><dl><dt><span class="section"><a href="kubectl.html#idp140">2.3.2.4.1. use-context</a></span></dt></dl></dd><dt><span class="section"><a href="kubectl.html#cluster-info">2.3.2.5. cluster-info</a></span></dt></dl></dd><dt><span class="section"><a href="kubectl.html#kubectl.namespace">2.3.3. namespace å‘½åç©ºé—´</a></span></dt><dt><span class="section"><a href="kubectl.html#kubectl.label">2.3.4. label æ ‡ç­¾</a></span></dt><dt><span class="section"><a href="kubectl.html#kubectl.pods">2.3.5. pods</a></span></dt><dd><dl><dt><span class="section"><a href="kubectl.html#idp141">2.3.5.1. æŸ¥çœ‹æ‰€æœ‰POD</a></span></dt><dt><span class="section"><a href="kubectl.html#idp142">2.3.5.2. è¿è¡Œ POD</a></span></dt><dt><span class="section"><a href="kubectl.html#get.pod">2.3.5.3. pod</a></span></dt><dt><span class="section"><a href="kubectl.html#idp143">2.3.5.4. åˆ é™¤ pod</a></span></dt><dt><span class="section"><a href="kubectl.html#kubectl.describe">2.3.5.5. æŸ¥çœ‹ Pod çš„äº‹ä»¶</a></span></dt><dt><span class="section"><a href="kubectl.html#idp147">2.3.5.6. Taintï¼ˆæ±¡ç‚¹ï¼‰å’Œ Tolerationï¼ˆå®¹å¿ï¼‰</a></span></dt><dd><dl><dt><span class="section"><a href="kubectl.html#idp144">2.3.5.6.1. Taintï¼ˆæ±¡ç‚¹ï¼‰è®¾ç½®</a></span></dt><dt><span class="section"><a href="kubectl.html#idp145">2.3.5.6.2. Tolerationï¼ˆå®¹å¿ï¼‰è°ƒåº¦</a></span></dt><dt><span class="section"><a href="kubectl.html#idp146">2.3.5.6.3. ä½¿ç”¨åœºæ™¯</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="kubectl.html#kubectl.expose">2.3.6. expose</a></span></dt><dt><span class="section"><a href="kubectl.html#kubectl.service">2.3.7. æœåŠ¡ç®¡ç†</a></span></dt><dd><dl><dt><span class="section"><a href="kubectl.html#idp148">2.3.7.1. åˆ—å‡ºæœåŠ¡</a></span></dt><dt><span class="section"><a href="kubectl.html#idp149">2.3.7.2. æŸ¥çœ‹æœåŠ¡è¯¦ç»†ä¿¡æ¯</a></span></dt><dt><span class="section"><a href="kubectl.html#idp150">2.3.7.3. æ›´æ–°æœåŠ¡</a></span></dt><dt><span class="section"><a href="kubectl.html#idp151">2.3.7.4. åˆ é™¤æœåŠ¡</a></span></dt><dt><span class="section"><a href="kubectl.html#idp152">2.3.7.5. clusterip</a></span></dt><dt><span class="section"><a href="kubectl.html#idp153">2.3.7.6. externalname</a></span></dt><dt><span class="section"><a href="kubectl.html#idp154">2.3.7.7. loadbalancer</a></span></dt><dt><span class="section"><a href="kubectl.html#idp155">2.3.7.8. nodeport</a></span></dt><dt><span class="section"><a href="kubectl.html#idp156">2.3.7.9. serviceaccount</a></span></dt></dl></dd><dt><span class="section"><a href="kubectl.html#kubectl.deployment">2.3.8. éƒ¨ç½²ç®¡ç†</a></span></dt><dd><dl><dt><span class="section"><a href="kubectl.html#idp157">2.3.8.1. </a></span></dt><dt><span class="section"><a href="kubectl.html#idp158">2.3.8.2. åˆ é™¤ deployment</a></span></dt></dl></dd><dt><span class="section"><a href="kubectl.html#kubectlscale">2.3.9. èµ„æºç®¡ç†</a></span></dt><dt><span class="section"><a href="kubectl.html#kubectl.logs">2.3.10. æŸ¥çœ‹ pod æ—¥å¿—</a></span></dt><dt><span class="section"><a href="kubectl.html#kubectl.exec">2.3.11. æ‰§è¡Œ Shell</a></span></dt><dt><span class="section"><a href="kubectl.html#kubectl.edit">2.3.12. edit</a></span></dt><dt><span class="section"><a href="kubectl.html#kubectl.rollout">2.3.13. rollout</a></span></dt><dt><span class="section"><a href="kubectl.html#kubectl.port-forward">2.3.14. port-forward ç«¯å£æ˜ å°„</a></span></dt><dt><span class="section"><a href="kubectl.html#kubectl.secret">2.3.15. secret å¯†é’¥ç®¡ç†</a></span></dt><dd><dl><dt><span class="section"><a href="kubectl.html#idp159">2.3.15.1. </a></span></dt><dt><span class="section"><a href="kubectl.html#idp160">2.3.15.2. Private Registry ç”¨æˆ·è®¤è¯</a></span></dt><dt><span class="section"><a href="kubectl.html#idp161">2.3.15.3. é…ç½®TLS SSL</a></span></dt></dl></dd><dt><span class="section"><a href="kubectl.html#kubectl.configmap">2.3.16. ConfigMap</a></span></dt><dd><dl><dt><span class="section"><a href="kubectl.html#idp162">2.3.16.1. åˆ›å»º Key-Value é…ç½®é¡¹</a></span></dt><dt><span class="section"><a href="kubectl.html#idp163">2.3.16.2. ä»æ–‡ä»¶åˆ›å»º ConfigMap</a></span></dt><dt><span class="section"><a href="kubectl.html#idp164">2.3.16.3. </a></span></dt><dt><span class="section"><a href="kubectl.html#idp165">2.3.16.4. æŸ¥çœ‹ ConfigMap</a></span></dt><dt><span class="section"><a href="kubectl.html#idp166">2.3.16.5. åˆ é™¤ ConfigMap</a></span></dt></dl></dd><dt><span class="section"><a href="kubectl.html#kubectl.cronjob">2.3.17. Job/CronJob</a></span></dt><dd><dl><dt><span class="section"><a href="kubectl.html#idp167">2.3.17.1. CronJob</a></span></dt></dl></dd><dt><span class="section"><a href="kubectl.html#kubectl.explain">2.3.18. explain</a></span></dt><dd><dl><dt><span class="section"><a href="kubectl.html#idp168">2.3.18.1. ingress</a></span></dt></dl></dd><dt><span class="section"><a href="kubectl.html#idp170">2.3.19. æ“ä½œç³»ç»Ÿ</a></span></dt><dd><dl><dt><span class="section"><a href="kubectl.html#idp169">2.3.19.1. sysctls</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="rancher.html">2.4. Rancher - Multi-Cluster Kubernetes Management</a></span></dt><dd><dl><dt><span class="section"><a href="rancher.html#idp175">2.4.1. å®‰è£…</a></span></dt><dd><dl><dt><span class="section"><a href="rancher.html#idp171">2.4.1.1. Ubuntu</a></span></dt><dt><span class="section"><a href="rancher.html#idp172">2.4.1.2. SSL è¯ä¹¦</a></span></dt><dt><span class="section"><a href="rancher.html#idp173">2.4.1.3. è¿›å…¥å®¹å™¨</a></span></dt><dt><span class="section"><a href="rancher.html#idp174">2.4.1.4. Rancher CLI</a></span></dt><dt><span class="section"><a href="rancher.html#rancher-compose">2.4.1.5. rancher-compose</a></span></dt></dl></dd><dt><span class="section"><a href="rancher.html#idp177">2.4.2. å¿«é€Ÿå…¥é—¨</a></span></dt><dd><dl><dt><span class="section"><a href="rancher.html#idp176">2.4.2.1. API</a></span></dt></dl></dd><dt><span class="section"><a href="rancher.html#idp183">2.4.3. Rancher CLI</a></span></dt><dd><dl><dt><span class="section"><a href="rancher.html#idp178">2.4.3.1. ç™»é™† Rancher</a></span></dt><dt><span class="section"><a href="rancher.html#idp179">2.4.3.2. æŸ¥çœ‹é›†ç¾¤</a></span></dt><dt><span class="section"><a href="rancher.html#idp180">2.4.3.3. æŸ¥çœ‹èŠ‚ç‚¹</a></span></dt><dt><span class="section"><a href="rancher.html#idp181">2.4.3.4. catalog</a></span></dt><dt><span class="section"><a href="rancher.html#idp182">2.4.3.5. æŸ¥çœ‹è®¾ç½®</a></span></dt></dl></dd><dt><span class="section"><a href="rancher.html#idp186">2.4.4. Rancher Compose</a></span></dt><dd><dl><dt><span class="section"><a href="rancher.html#idp184">2.4.4.1. Rancher Compose å‘½ä»¤</a></span></dt><dt><span class="section"><a href="rancher.html#idp185">2.4.4.2. æ“ä½œæ¼”ç¤º</a></span></dt></dl></dd><dt><span class="section"><a href="rancher.html#idp187">2.4.5. Rancher Kubernetes Engine (RKE)</a></span></dt><dt><span class="section"><a href="rancher.html#rancher.cli">2.4.6. Rancher CLI</a></span></dt><dt><span class="section"><a href="rancher.html#idp188">2.4.7. è°ƒè¯•</a></span></dt><dt><span class="section"><a href="rancher.html#idp190">2.4.8. FAQ</a></span></dt><dd><dl><dt><span class="section"><a href="rancher.html#idp189">2.4.8.1.  [network] Host [rancher.netkiller.cn] is not able to connect to the following ports: [rancher.netkiller.cn:2379]. Please check network policies and firewall rules</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="helm.html">2.5. Helm - The package manager for Kubernetes</a></span></dt><dd><dl><dt><span class="section"><a href="helm.html#helm.setup">2.5.1. å®‰è£… Helm</a></span></dt><dd><dl><dt><span class="section"><a href="helm.html#idp191">2.5.1.1. Ubuntu</a></span></dt><dt><span class="section"><a href="helm.html#idp192">2.5.1.2. Mac</a></span></dt></dl></dd><dt><span class="section"><a href="helm.html#idp193">2.5.2. å¿«é€Ÿå¼€å§‹</a></span></dt><dt><span class="section"><a href="helm.html#helm.command">2.5.3. Helm å‘½ä»¤</a></span></dt><dd><dl><dt><span class="section"><a href="helm.html#idp194">2.5.3.1. åˆå§‹åŒ– Helm</a></span></dt><dt><span class="section"><a href="helm.html#idp195">2.5.3.2. æŸ¥çœ‹ä»“åº“åˆ—è¡¨</a></span></dt><dt><span class="section"><a href="helm.html#idp196">2.5.3.3. æœç´¢</a></span></dt><dt><span class="section"><a href="helm.html#idp197">2.5.3.4. æŸ¥çœ‹åŒ…ä¿¡æ¯</a></span></dt><dt><span class="section"><a href="helm.html#idp198">2.5.3.5. å®‰è£…</a></span></dt><dt><span class="section"><a href="helm.html#idp199">2.5.3.6. åˆ—è¡¨</a></span></dt><dt><span class="section"><a href="helm.html#idp200">2.5.3.7. åˆ é™¤</a></span></dt><dt><span class="section"><a href="helm.html#idp201">2.5.3.8. å‡çº§</a></span></dt><dt><span class="section"><a href="helm.html#idp202">2.5.3.9. å›æ»š</a></span></dt><dt><span class="section"><a href="helm.html#idp203">2.5.3.10. æŸ¥çœ‹çŠ¶æ€</a></span></dt></dl></dd><dt><span class="section"><a href="helm.html#idp204">2.5.4. elastic</a></span></dt><dt><span class="section"><a href="helm.html#helm.faq">2.5.5. Helm Faq</a></span></dt></dl></dd><dt><span class="section"><a href="kubectl.example.html">2.6. kubectl example</a></span></dt><dd><dl><dt><span class="section"><a href="kubectl.example.html#idp205">2.6.1. ç§æœ‰ registry</a></span></dt><dt><span class="section"><a href="kubectl.example.html#idp206">2.6.2. mongodb</a></span></dt><dt><span class="section"><a href="kubectl.example.html#idp207">2.6.3. tomcat</a></span></dt></dl></dd><dt><span class="section"><a href="kubectl.yaml.html">2.7. Kubectl YAML</a></span></dt><dd><dl><dt><span class="section"><a href="kubectl.yaml.html#ServiceAccount">2.7.1. ServiceAccount</a></span></dt><dd><dl><dt><span class="section"><a href="kubectl.yaml.html#idp208">2.7.1.1. </a></span></dt></dl></dd><dt><span class="section"><a href="kubectl.yaml.html#Namespace">2.7.2. åˆ›å»ºå‘½åç©ºé—´</a></span></dt><dt><span class="section"><a href="kubectl.yaml.html#Pod">2.7.3. Pod</a></span></dt><dd><dl><dt><span class="section"><a href="kubectl.yaml.html#idp209">2.7.3.1. æŒ‡å®šä¸»æœºå</a></span></dt><dt><span class="section"><a href="kubectl.yaml.html#idp210">2.7.3.2. </a></span></dt><dt><span class="section"><a href="kubectl.yaml.html#idp211">2.7.3.3. å¥åº·çŠ¶æ€æ£€æŸ¥</a></span></dt><dt><span class="section"><a href="kubectl.yaml.html#securityContext">2.7.3.4. securityContext</a></span></dt><dd><dl><dt><span class="section"><a href="kubectl.yaml.html#idp212">2.7.3.4.1. sysctls</a></span></dt><dt><span class="section"><a href="kubectl.yaml.html#idp213">2.7.3.4.2. runAsUser</a></span></dt><dt><span class="section"><a href="kubectl.yaml.html#idp214">2.7.3.4.3. security.alpha.kubernetes.io/sysctls</a></span></dt></dl></dd><dt><span class="section"><a href="kubectl.yaml.html#idp215">2.7.3.5. Taintï¼ˆæ±¡ç‚¹ï¼‰å’Œ Tolerationï¼ˆå®¹å¿ï¼‰</a></span></dt></dl></dd><dt><span class="section"><a href="kubectl.yaml.html#Service">2.7.4. Service</a></span></dt><dd><dl><dt><span class="section"><a href="kubectl.yaml.html#idp216">2.7.4.1. åˆ›å»ºæœåŠ¡</a></span></dt><dt><span class="section"><a href="kubectl.yaml.html#idp217">2.7.4.2. æŸ¥çœ‹æœåŠ¡</a></span></dt><dt><span class="section"><a href="kubectl.yaml.html#idp218">2.7.4.3. è®¾ç½®å¤–éƒ¨IP</a></span></dt><dt><span class="section"><a href="kubectl.yaml.html#idp219">2.7.4.4. ç»‘å®šå¤–éƒ¨åŸŸå</a></span></dt><dt><span class="section"><a href="kubectl.yaml.html#idp220">2.7.4.5. </a></span></dt><dt><span class="section"><a href="kubectl.yaml.html#idp221">2.7.4.6. nodePort</a></span></dt><dt><span class="section"><a href="kubectl.yaml.html#idp222">2.7.4.7. LoadBalancer</a></span></dt><dt><span class="section"><a href="kubectl.yaml.html#idp223">2.7.4.8. Example</a></span></dt></dl></dd><dt><span class="section"><a href="kubectl.yaml.html#ConfigMap">2.7.5. ConfigMap</a></span></dt><dd><dl><dt><span class="section"><a href="kubectl.yaml.html#idp224">2.7.5.1. Key-Value é…ç½®</a></span></dt><dt><span class="section"><a href="kubectl.yaml.html#idp225">2.7.5.2. ç¯å¢ƒå˜é‡</a></span></dt><dt><span class="section"><a href="kubectl.yaml.html#idp226">2.7.5.3. é…ç½®æ–‡ä»¶</a></span></dt></dl></dd><dt><span class="section"><a href="kubectl.yaml.html#Volume">2.7.6. Volume</a></span></dt><dd><dl><dt><span class="section"><a href="kubectl.yaml.html#idp228">2.7.6.1. local</a></span></dt><dd><dl><dt><span class="section"><a href="kubectl.yaml.html#idp227">2.7.6.1.1. æ¡ˆä¾‹</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="kubectl.yaml.html#Job">2.7.7. Job</a></span></dt><dd><dl><dt><span class="section"><a href="kubectl.yaml.html#idp229">2.7.7.1. æ‰§è¡Œå•è¯ä»»åŠ¡</a></span></dt><dt><span class="section"><a href="kubectl.yaml.html#idp230">2.7.7.2. è®¡åˆ’ä»»åŠ¡</a></span></dt></dl></dd><dt><span class="section"><a href="kubectl.yaml.html#Ingress">2.7.8. Ingress</a></span></dt><dd><dl><dt><span class="section"><a href="kubectl.yaml.html#idp231">2.7.8.1. ç«¯å£</a></span></dt><dt><span class="section"><a href="kubectl.yaml.html#idp232">2.7.8.2. URI è§„åˆ™</a></span></dt><dt><span class="section"><a href="kubectl.yaml.html#idp233">2.7.8.3. vhost è™šæ‹Ÿä¸»æœº</a></span></dt><dt><span class="section"><a href="kubectl.yaml.html#idp234">2.7.8.4. rewrite</a></span></dt><dt><span class="section"><a href="kubectl.yaml.html#idp237">2.7.8.5. annotations é…ç½®</a></span></dt><dd><dl><dt><span class="section"><a href="kubectl.yaml.html#idp235">2.7.8.5.1. HTTP è·³è½¬åˆ° HTTPS</a></span></dt><dt><span class="section"><a href="kubectl.yaml.html#idp236">2.7.8.5.2. server-snippet</a></span></dt></dl></dd><dt><span class="section"><a href="kubectl.yaml.html#idp242">2.7.8.6. é‡‘ä¸é›€å‘å¸ƒï¼ˆç°åº¦å‘å¸ƒï¼‰</a></span></dt><dd><dl><dt><span class="section"><a href="kubectl.yaml.html#idp238">2.7.8.6.1. å‡†å¤‡æœåŠ¡</a></span></dt><dt><span class="section"><a href="kubectl.yaml.html#idp239">2.7.8.6.2. æ–¹æ¡ˆä¸€ï¼Œæƒé‡åˆ†é…</a></span></dt><dt><span class="section"><a href="kubectl.yaml.html#idp240">2.7.8.6.3. é€šè¿‡HTTPå¤´å¼€å¯ç°åº¦å‘å¸ƒ</a></span></dt><dt><span class="section"><a href="kubectl.yaml.html#idp241">2.7.8.6.4. é€šè¿‡ Cookie å¼€å¯</a></span></dt></dl></dd><dt><span class="section"><a href="kubectl.yaml.html#idp243">2.7.8.7. ç®¡ç† Ingress</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="istio.html">2.8. istio</a></span></dt><dd><dl><dt><span class="section"><a href="istio.html#idp244">2.8.1. å¯åŠ¨ istio</a></span></dt><dt><span class="section"><a href="istio.html#idp245">2.8.2. ç¦ç”¨ istio</a></span></dt></dl></dd><dt><span class="section"><a href="ch02s09.html">2.9. Kubeapps</a></span></dt></dl></div>
	
	
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="minikube"></a>2.1.Â Minikube</h2></div></div></div>
	
	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="minikube.install"></a>2.1.1.Â CentOS 8 å®‰è£… minikube</h3></div></div></div>
		
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp104"></a>2.1.1.1.Â CentOS</h4></div></div></div>
			
			<p>æ‰§è¡Œä¸‹é¢å‘½ä»¤æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦å¼€å¯è™šæ‹ŸåŒ–æŠ€æœ¯</p>
			<pre class="screen">
			
egrep --color 'vmx|svm' /proc/cpuinfo
			
			</pre>
			<p>å¦‚æœæ²¡æœ‰ä»»ä½•è¾“å‡ºï¼Œè¯·é‡å¯æœåŠ¡å™¨è¿›å…¥ BIOS å¯ç”¨ VT-X æˆ– AMD-v</p>

			<pre class="screen">
			
curl -LO https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64 \
  &amp;&amp; install minikube-linux-amd64 /usr/local/bin/minikube			
			
			</pre>
			<p>å°è¯•è¿è¡Œ minikube å¦‚æœè¾“å‡ºå¸®åŠ©ä¿¡æ¯è¡¨ç¤ºå®‰è£…æˆåŠŸ</p>
			<pre class="screen">
			
[root@localhost ~]# minikube version
minikube version: v1.13.0
commit: 0c5e9de4ca6f9c55147ae7f90af97eff5befef5f-dirty			
			
			</pre>
			<p></p>
			<pre class="screen">
			
echo "1" &gt; /proc/sys/net/bridge/bridge-nf-call-iptables			
			
			</pre>
			<p>dnf å®‰è£… kubectl</p>
			<pre class="screen">
			
cat &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo
[kubernetes]
name=Kubernetes
baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-x86_64
enabled=1
gpgcheck=1
repo_gpgcheck=1
gpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg
EOF
			
			</pre>
			<pre class="screen">
			
[root@localhost ~]# dnf install kubectl
			
			</pre>
			<p>äºŒè¿›åˆ¶å®‰è£… kubectl</p>
			<pre class="screen">
						
curl -LO "https://storage.googleapis.com/kubernetes-release/release/$(curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/linux/amd64/kubectl" \
	&amp;&amp; install kubectl /usr/local/bin/kubectl
			
			</pre>
			<div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idp103"></a>2.1.1.1.1.Â æ— è™šæ‹Ÿæœº</h5></div></div></div>
				
				<p>å¦‚æœä½ ä¸æƒ³å®‰è£…è™šæ‹Ÿæœº</p>
				<pre class="screen">
			
adduser docker
su - docker
sudo usermod -aG docker $USER &amp;&amp; newgrp docker			
			
				</pre>
				<p></p>
				<pre class="screen">
				
[docker@localhost ~]$ minikube start --driver=docker
* minikube v1.13.0 on Centos 8.2.2004
* Using the docker driver based on user configuration

X Requested memory allocation (1694MB) is less than the recommended minimum 2000MB. Deployments may fail.


X The requested memory allocation of 1694MiB does not leave room for system overhead (total system memory: 1694MiB). You may face stability issues.
* Suggestion: Start minikube with less memory allocated: 'minikube start --memory=1694mb'

* Starting control plane node minikube in cluster minikube
* Pulling base image ...
* Downloading Kubernetes v1.19.0 preload ...
    &gt; preloaded-images-k8s-v6-v1.19.0-docker-overlay2-amd64.tar.lz4: 486.28 MiB				
				
				</pre>
			</div>

		</div>

		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp105"></a>2.1.1.2.Â Mac OS</h4></div></div></div>
			
			<p>æ£€æŸ¥ç¡¬ä»¶æ˜¯å¦æ”¯æŒè™šæ‹ŸåŒ–</p>
			<pre class="screen">
			
iMac:Linux neo$ sysctl -a | grep -E --color 'machdep.cpu.features|VMX'
machdep.cpu.features: FPU VME DE PSE TSC MSR PAE MCE CX8 APIC SEP MTRR PGE MCA CMOV PAT PSE36 CLFSH DS ACPI MMX FXSR SSE SSE2 SS HTT TM PBE SSE3 PCLMULQDQ DTES64 MON DSCPL VMX SMX EST TM2 SSSE3 CX16 TPR PDCM SSE4.1 SSE4.2 x2APIC POPCNT AES PCID XSAVE OSXSAVE TSCTMR AVX1.0			
			
			</pre>
			<pre class="screen">
			
$ brew install minikube
$ brew install kubectl
$ brew install kubernetes-helm
			
			</pre>
			<pre class="screen">
			
neo@MacBook-Pro-Neo ~ % minikube start                 
ğŸ˜„  minikube v1.13.1 on Darwin 11.0
ğŸ†•  Kubernetes 1.19.2 is now available. If you would like to upgrade, specify: --kubernetes-version=v1.19.2
âœ¨  Using the hyperkit driver based on existing profile
ğŸ‘  Starting control plane node minikube in cluster minikube
ğŸ”„  Restarting existing hyperkit VM for "minikube" ...
â—  This VM is having trouble accessing https://k8s.gcr.io
ğŸ’¡  To pull new external images, you may need to configure a proxy: https://minikube.sigs.k8s.io/docs/reference/networking/proxy/
ğŸ³  Preparing Kubernetes v1.19.0 on Docker 19.03.12 ...
ğŸ”  Verifying Kubernetes components...
ğŸŒŸ  Enabled addons: dashboard, default-storageclass, storage-provisioner
ğŸ„  Done! kubectl is now configured to use "minikube" by default			
			
			</pre>
			<p>æœ‰äº›è€ç³»ç»Ÿå¯èƒ½ä¸æ”¯æŒ hyperkitï¼Œéœ€è¦virtualboxã€‚</p>
			<pre class="screen">
			
$ brew cask install virtualbox
$ minikube start â€”vm-driver=virtualbox
$ minikube dashboard			
			
			</pre>
		</div>
	</div>
	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="minikube.Quickstart"></a>2.1.2.Â Quickstart</h3></div></div></div>
		
		<p>å¯åŠ¨</p>
		<pre class="screen">
		
minikube start
		
		</pre>
		<p>è¿è¡Œä¸€ä¸ª echoserver é•œåƒ</p>
		<pre class="screen">
		
kubectl run hello-minikube --image=k8s.gcr.io/echoserver:1.4 --port=8080
kubectl expose deployment hello-minikube --type=NodePort
minikube service hello-minikube
		
		</pre>
		<p>æŸ¥è¯¢ echoserver è®¿é—®åœ°å€</p>
		<pre class="screen">
		
minikube service hello-minikube --url		
		
		</pre>
		<p>åœ¨æµè§ˆå™¨ä¸­è®¿é—®æŸ¥è¯¢åˆ°çš„ç½‘å€</p>
		<p>åœæ­¢å¹¶åˆ é™¤é•œåƒ</p>
		<pre class="screen">
		
minikube stop
minikube delete		
		
		</pre>
		<div class="example"><a id="idp253"></a><p class="title"><strong>ä¾‹Â 2.1.Â minikube æ“ä½œæ¼”ç¤º</strong></p><div class="example-contents">
			
			<p>å¿«é€Ÿå¼€å§‹ä½¿ç”¨ minikube è¿è¡Œä¸€ä¸ªé•œåƒ</p>
			<pre class="screen">
			
[root@localhost ~]# kubectl run hello-minikube --image=k8s.gcr.io/echoserver:1.4 --port=8080
kubectl run --generator=deployment/apps.v1 is DEPRECATED and will be removed in a future version. Use kubectl run --generator=run-pod/v1 or kubectl create instead.
deployment.apps/hello-minikube created

[root@localhost ~]# kubectl expose deployment hello-minikube --type=NodePort
service/hello-minikube exposed

[root@localhost ~]# minikube service hello-minikube
Opening kubernetes service default/hello-minikube in default browser...		

[root@localhost ~]# kubectl get pod
NAME                              READY   STATUS    RESTARTS   AGE
hello-minikube-5c856cbf98-6vfvp   1/1     Running   0          6m59s

[root@localhost ~]# minikube service hello-minikube --url
http://172.16.0.121:30436

[root@localhost ~]# curl http://172.16.0.121:30436
CLIENT VALUES:
client_address=172.17.0.1
command=GET
real path=/
query=nil
request_version=1.1
request_uri=http://172.16.0.121:8080/

SERVER VALUES:
server_version=nginx: 1.10.0 - lua: 10001

HEADERS RECEIVED:
accept=*/*
host=172.16.0.121:30436
user-agent=curl/7.29.0
BODY:
-no body in request-
			
			</pre>
		</div></div><br class="example-break" />
	</div>

	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="minikube.command"></a>2.1.3.Â minikube å‘½ä»¤</h3></div></div></div>
		
		<pre class="screen">
			
[root@localhost ~]# minikube
Minikube is a CLI tool that provisions and manages single-node Kubernetes clusters optimized for development workflows.

Usage:
  minikube [command]

Available Commands:
  addons         Modify minikube's kubernetes addons
  cache          Add or delete an image from the local cache.
  completion     Outputs minikube shell completion for the given shell (bash or zsh)
  config         Modify minikube config
  dashboard      Access the kubernetes dashboard running within the minikube cluster
  delete         Deletes a local kubernetes cluster
  docker-env     Sets up docker env variables; similar to '$(docker-machine env)'
  help           Help about any command
  ip             Retrieves the IP address of the running cluster
  logs           Gets the logs of the running instance, used for debugging minikube, not user code
  mount          Mounts the specified directory into minikube
  profile        Profile sets the current minikube profile
  service        Gets the kubernetes URL(s) for the specified service in your local cluster
  ssh            Log into or run a command on a machine with SSH; similar to 'docker-machine ssh'
  ssh-key        Retrieve the ssh identity key path of the specified cluster
  start          Starts a local kubernetes cluster
  status         Gets the status of a local kubernetes cluster
  stop           Stops a running local kubernetes cluster
  tunnel         tunnel makes services of type LoadBalancer accessible on localhost
  update-check   Print current and latest version number
  update-context Verify the IP address of the running cluster in kubeconfig.
  version        Print the version of minikube

Flags:
      --alsologtostderr                  log to standard error as well as files
  -b, --bootstrapper string              The name of the cluster bootstrapper that will set up the kubernetes cluster. (default "kubeadm")
  -h, --help                             help for minikube
      --log_backtrace_at traceLocation   when logging hits line file:N, emit a stack trace (default :0)
      --log_dir string                   If non-empty, write log files in this directory
      --logtostderr                      log to standard error instead of files
  -p, --profile string                   The name of the minikube VM being used.  
                                         	This can be modified to allow for multiple minikube instances to be run independently (default "minikube")
      --stderrthreshold severity         logs at or above this threshold go to stderr (default 2)
  -v, --v Level                          log level for V logs
      --vmodule moduleSpec               comma-separated list of pattern=N settings for file-filtered logging

Use "minikube [command] --help" for more information about a command.			
			
		</pre>

		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="minikube.start"></a>2.1.3.1.Â å¯åŠ¨ minikube</h4></div></div></div>
			
			<div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idp106"></a>2.1.3.1.1.Â è™šæ‹Ÿæœºé©±åŠ¨</h5></div></div></div>
				
				<p>--vm-driver=none</p>
				<pre class="screen">
				
minikube start --vm-driver=none
				
				</pre>
			</div>
			<div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idp107"></a>2.1.3.1.2.Â å¼€å¯GPU</h5></div></div></div>
				
				<pre class="screen">
				
minikube start --vm-driver kvm2 --gpu				
				
				</pre>
			</div>
			<div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idp108"></a>2.1.3.1.3.Â æ—¥å¿—è¾“å‡ºçº§åˆ«</h5></div></div></div>
				
				<p>æŒ‡å®šæ—¥å¿—è¾“å‡ºçº§åˆ«</p>
				<pre class="screen">
				
minikube start --v=7			
				
				</pre>
			</div>
			<div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idp109"></a>2.1.3.1.4.Â CPU å’Œ å†…å­˜åˆ†é…</h5></div></div></div>
				
				<pre class="screen">
				
minikube start --memory 8000 --cpus 2			
				
				</pre>
			</div>
			<div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idp110"></a>2.1.3.1.5.Â æŒ‡å®š kubernetes ç‰ˆæœ¬</h5></div></div></div>
				
				<pre class="screen">
				
minikube start --memory 8000 --cpus 2 --kubernetes-version v1.6.0					
				
				</pre>
			</div>
			<div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idp111"></a>2.1.3.1.6.Â é…ç½®å¯åŠ¨é¡¹</h5></div></div></div>
				
				<pre class="screen">
				
minikube start --extra-config=apiserver.v=10 --extra-config=kubelet.max-pods=100				
				
				</pre>
			</div>
			<div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idp112"></a>2.1.3.1.7.Â æŒ‡å®š registry-mirror é•œåƒ</h5></div></div></div>
				
				<pre class="screen">
				
minikube start --registry-mirror=https://registry.docker-cn.com

minikube start --image-mirror-country=cn --registry-mirror="https://docker.mirrors.ustc.edu.cn" --insecure-registry="127.0.0.1:5000"				

minikube start --image-mirror-country=cn --registry-mirror="https://docker.mirrors.ustc.edu.cn" --insecure-registry="192.168.0.0/24"
				
				</pre>
			</div>
			<div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idp113"></a>2.1.3.1.8.Â æŒ‡å®šä¸‹è½½é•œåƒ</h5></div></div></div>
				
				<pre class="screen">
				
minikube start --image-mirror-country=cn --image-repository=registry.cn-hangzhou.aliyuncs.com/google_containers				
				
				</pre>
				<pre class="screen">
				
# ä»é˜¿é‡Œäº‘ä¸‹è½½ virtualbox é•œåƒ
minikube start --vm-driver='virtualbox' --image-mirror-country cn \
    --iso-url=https://kubernetes.oss-cn-hangzhou.aliyuncs.com/minikube/iso/minikube-v1.9.0.iso \
    --registry-mirror=https://docker.mirrors.ustc.edu.cn

minikube start --vm-driver=virtualbox \
--image-mirror-country cn \
--registry-mirror=https://docker.mirrors.ustc.edu.cn \
--image-repository=registry.aliyuncs.com/google_containers \
--insecure-registry=192.168.0.10:5000 //è®¿é—®å®¿ä¸»æœºçš„ç§æœ‰dockerä»“åº“				
				
				</pre>
			</div>
			<div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idp114"></a>2.1.3.1.9.Â Enabling Unsafe Sysctls</h5></div></div></div>
				
				<pre class="screen">
				
minikube start --extra-config="kubelet.allowed-unsafe-sysctls=kernel.msg*,net.core.somaxconn".
				
				</pre>
			</div>
		</div>
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="minikube.stop"></a>2.1.3.2.Â åœæ­¢ minikube</h4></div></div></div>
			
			<pre class="screen">
			
[root@localhost ~]# minikube stop
Stopping local Kubernetes cluster...
Machine stopped.			
			
			</pre>
		</div>
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp115"></a>2.1.3.3.Â Docker ç¯å¢ƒå˜é‡</h4></div></div></div>
			
			<pre class="screen">
			
neo@MacBook-Pro-Neo ~ % minikube docker-env
export DOCKER_TLS_VERIFY="1"
export DOCKER_HOST="tcp://192.168.64.3:2376"
export DOCKER_CERT_PATH="/Users/neo/.minikube/certs"
export MINIKUBE_ACTIVE_DOCKERD="minikube"

# To point your shell to minikube's docker-daemon, run:
# eval $(minikube -p minikube docker-env)			
			
			</pre>
			<p>è®¾ç½®ç¯å¢ƒå˜é‡</p>
			<pre class="screen">
			
# eval $(minikube docker-env)	
# eval $(minikube -p minikube docker-env)	
			
			</pre>
		</div>
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="minikube.ssh"></a>2.1.3.4.Â SSH</h4></div></div></div>
			
			<pre class="screen">
			
neo@MacBook-Pro-Neo ~ % minikube ssh                                                           
                         _             _            
            _         _ ( )           ( )           
  ___ ___  (_)  ___  (_)| |/')  _   _ | |_      __  
/' _ ` _ `\| |/' _ `\| || , &lt;  ( ) ( )| '_`\  /'__`\
| ( ) ( ) || || ( ) || || |\`\ | (_) || |_) )(  ___/
(_) (_) (_)(_)(_) (_)(_)(_) (_)`\___/'(_,__/'`\____)

$ 			
			
			</pre>
		</div>

		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp116"></a>2.1.3.5.Â ç¼“å­˜é•œåƒ</h4></div></div></div>
			
			<pre class="screen">
			
# cache a image into $HOME/.minikube/cache/images

$ minikube cache add ubuntu:16.04
$ minikube cache add redis:3

# list cached images
$ minikube cache list
redis:3
ubuntu:16.04

# delete cached images
$ minikube cache delete ubuntu:16.04
$ minikube cache delete $(minikube cache list)
			
			</pre>
		</div>
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp117"></a>2.1.3.6.Â æ¸…ç† minikube</h4></div></div></div>
			
			<pre class="screen">
			
minikube delete
rm ~/.minikube 
minikube start
			
			</pre>
		</div>
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp118"></a>2.1.3.7.Â Kubernetes æ§åˆ¶é¢æ¿</h4></div></div></div>
			
			<p>Dashboardæ˜¯åŸºäºWebçš„Kubernetesç®¡ç†ç•Œé¢ã€‚ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å¯åŠ¨ï¼š</p>
			<pre class="screen">
			
minikube dashboard
			
			</pre>
			<p>æŸ¥è¯¢æ§åˆ¶é¢æ¿è®¿é—®åœ°å€</p>
			<pre class="screen">
			
$ minikube dashboard --url
http://192.168.3.14:30000			
			
			</pre>
		</div>
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp119"></a>2.1.3.8.Â service</h4></div></div></div>
			
			<p></p>
			<pre class="screen">
			
[root@localhost ~]# minikube service hello-minikube --url
http://172.16.0.121:30436			
			
			</pre>
		</div>
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp120"></a>2.1.3.9.Â æŸ¥çœ‹æ—¥å¿—</h4></div></div></div>
			
			<pre class="screen">
			
minikube logs -v10			
			
			</pre>
		</div>
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp121"></a>2.1.3.10.Â æŸ¥çœ‹ Docker ç¯å¢ƒå˜é‡</h4></div></div></div>
			
			<pre class="screen">
			
minikube docker-env
			
			</pre>
		</div>
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="minikube.profile"></a>2.1.3.11.Â profile</h4></div></div></div>
			
			<pre class="screen">
			
minikube profile demo
minikube start -p demo --memory=8192 --cpus=6 --disk-size=50g			
			
			</pre>
		</div>
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="minikube.addons"></a>2.1.3.12.Â addons</h4></div></div></div>
			
			<div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idp122"></a>2.1.3.12.1.Â å¯ç”¨ addons</h5></div></div></div>
				
				<pre class="screen">
				
minikube addons enable heapster
minikube addons enable ingress		
				
				</pre>
				<p>å¯ç”¨ WebUI</p>
				<pre class="screen">
				
[root@localhost ~]# minikube addons enable dashboard
dashboard was successfully enabled
[root@localhost ~]# minikube addons list | grep dashboard
- dashboard: enabled				
				
				</pre>
			</div>
			<div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idp123"></a>2.1.3.12.2.Â æŸ¥çœ‹ addons åˆ—è¡¨</h5></div></div></div>
				
				<pre class="screen">
				
[root@localhost ~]# minikube addons list
- addon-manager: enabled
- dashboard: enabled
- default-storageclass: enabled
- efk: disabled
- freshpod: disabled
- gvisor: disabled
- heapster: disabled
- ingress: disabled
- kube-dns: disabled
- metrics-server: disabled
- nvidia-driver-installer: disabled
- nvidia-gpu-device-plugin: disabled
- registry: disabled
- registry-creds: disabled
- storage-provisioner: enabled
- storage-provisioner-gluster: disabled			
				
				</pre>
			</div>
		</div>
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="minikube.ssh"></a>2.1.3.13.Â SSH</h4></div></div></div>
			
			<p>--vm-driver=none ä¸æ”¯æŒ ssh</p>
			<pre class="screen">
			
[root@localhost ~]# minikube ssh
'none' driver does not support 'minikube ssh' command			
			
			</pre>
		</div>
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="minikube.ip"></a>2.1.3.14.Â æŸ¥çœ‹IPåœ°å€</h4></div></div></div>
			
			<pre class="screen">
			
[root@localhost ~]# minikube ip
172.16.0.121			
			
			</pre>
		</div>
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="minikube.addons"></a>2.1.3.15.Â addons</h4></div></div></div>
			
			<div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idp124"></a>2.1.3.15.1.Â æŸ¥çœ‹æ‰€æœ‰æ’ä»¶</h5></div></div></div>
				
				<pre class="screen">
				
iMac:registry neo$ minikube addons list
|-----------------------------|----------|--------------|
|         ADDON NAME          | PROFILE  |    STATUS    |
|-----------------------------|----------|--------------|
| ambassador                  | minikube | disabled     |
| dashboard                   | minikube | enabled âœ…   |
| default-storageclass        | minikube | enabled âœ…   |
| efk                         | minikube | disabled     |
| freshpod                    | minikube | disabled     |
| gcp-auth                    | minikube | disabled     |
| gvisor                      | minikube | disabled     |
| helm-tiller                 | minikube | disabled     |
| ingress                     | minikube | disabled     |
| ingress-dns                 | minikube | disabled     |
| istio                       | minikube | disabled     |
| istio-provisioner           | minikube | disabled     |
| kubevirt                    | minikube | disabled     |
| logviewer                   | minikube | disabled     |
| metallb                     | minikube | disabled     |
| metrics-server              | minikube | disabled     |
| nvidia-driver-installer     | minikube | disabled     |
| nvidia-gpu-device-plugin    | minikube | disabled     |
| olm                         | minikube | disabled     |
| pod-security-policy         | minikube | disabled     |
| registry                    | minikube | disabled     |
| registry-aliases            | minikube | disabled     |
| registry-creds              | minikube | disabled     |
| storage-provisioner         | minikube | enabled âœ…   |
| storage-provisioner-gluster | minikube | disabled     |
|-----------------------------|----------|--------------|				
				
				</pre>
			</div>
			<div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idp125"></a>2.1.3.15.2.Â å¼€å¯ registry ç§æœ‰åº“</h5></div></div></div>
				
				<pre class="screen">
		
# enable the registry addon
$ minikube addons enable registry

$ minikube start

# use the minikube docker daemon from the host
$ eval $(minikube docker-env)

# get the ip of the registry endpoint
$ kubectl -n kube-system get svc registry -o jsonpath="{.spec.clusterIP}"
10.0.0.240	
		
				</pre>
				<pre class="screen">
		
{
  "insecure-registries" : ["10.0.0.240"]
}		
		
				</pre>

				<p></p>
				<pre class="screen">
		
$ minikube ssh
$ docker pull busybox
$ docker tag busybox 10.0.0.240/busybox

# or

# build and push to insecure registry
$ docker build -t 10.0.0.240/busybox .
$ docker push 10.0.0.240/busybox
		
				</pre>
				
			</div>
			<div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idp126"></a>2.1.3.15.3.Â å¯ç”¨ ingress</h5></div></div></div>
				
				<pre class="screen">
				
iMac:kubernetes neo$ minikube addons enable ingress				
				
				</pre>
			</div>
		</div>
	</div>
	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="minikube.faq"></a>2.1.4.Â FAQ</h3></div></div></div>
		
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp127"></a>2.1.4.1.Â This computer doesn't have VT-X/AMD-v enabled. Enabling it in the BIOS is mandatory</h4></div></div></div>
			
			<p>æ£€æŸ¥ä¸€ä¸‹ BIOS æ˜¯å¦å¼€å¯ VT-X/AMD-v</p>
			<p>å¦‚æœåœ¨è™šæ‹Ÿæœºå®‰è£… Minikube ä¹Ÿä¼šé‡åˆ°è¿™ä¸ªé—®é¢˜ã€‚ å¯ä»¥ä½¿ç”¨ --vm-driver=none å‚æ•°å¯åŠ¨ã€‚</p>
			<pre class="screen">
			
neo@ubuntu:~$ sudo minikube start --vm-driver=none
			
			</pre>
		</div>
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp128"></a>2.1.4.2.Â ERROR FileContent--proc-sys-net-bridge-bridge-nf-call-iptables</h4></div></div></div>
			
			<p>è§£å†³æ–¹æ³•</p>
			<pre class="screen">
			
echo "1" &gt; /proc/sys/net/bridge/bridge-nf-call-iptables
			
			</pre>
			<p>ç„¶ååœ¨ minikube start</p>
		</div>
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp129"></a>2.1.4.3.Â ERROR ImagePull</h4></div></div></div>
			
			<p>[ERROR ImagePull]: failed to pull image k8s.gcr.io/pause:3.1: output: 3.1: Pulling from pause
				Get https://k8s.gcr.io/v2/pause/manifests/sha256:59eec8837a4d942cc19a52b8c09ea75121acc38114a2c68b98983ce9356b8610: net/http: TLS handshake timeout
			</p>
			<p>æ›´æ¢é•œåƒå†é‡è¯•</p>
			<pre class="screen">
			
[root@localhost ~]# minikube start --vm-driver=none --registry-mirror=https://registry.docker-cn.com			
			
			</pre>
		</div>
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp130"></a>2.1.4.4.Â è¯ä¹¦å·²å­˜åœ¨é”™è¯¯</h4></div></div></div>
			
			<p>å¯åŠ¨æç¤ºå¦‚ä¸‹é”™è¯¯ï¼Œä¸€èˆ¬å‡ºç°è¿™ç§é”™è¯¯æ˜¯å› ä¸º minikube stop, minikube delete åå†é‡å¯ minikube start</p>
			<pre class="screen">
			
error execution phase kubeconfig/admin: a kubeconfig file "/etc/kubernetes/admin.conf" exists already but has got the wrong CA cert	
error execution phase kubeconfig/kubelet: a kubeconfig file "/etc/kubernetes/kubelet.conf" exists already but has got the wrong CA cert
error execution phase kubeconfig/controller-manager: a kubeconfig file "/etc/kubernetes/controller-manager.conf" exists already but has got the wrong CA cert
error execution phase kubeconfig/scheduler: a kubeconfig file "/etc/kubernetes/scheduler.conf" exists already but has got the wrong CA cert
			
			</pre>
			<p>è§£å†³æ–¹æ³•</p>
			<pre class="screen">
			
[root@localhost ~]# mv /etc/kubernetes/admin.conf /etc/kubernetes/admin.conf.backup
[root@localhost ~]# mv /etc/kubernetes/kubelet.conf /etc/kubernetes/kubelet.conf.backup
[root@localhost ~]# mv /etc/kubernetes/controller-manager.conf /etc/kubernetes/controller-manager.conf.backup
[root@localhost ~]# mv /etc/kubernetes/scheduler.conf /etc/kubernetes/scheduler.conf.backup
			
			</pre>
			<p>ç°åœ¨å¯åŠ¨ minikube start ä¸ä¼šå†å‡ºé”™</p>
			<pre class="screen">
			
[root@localhost ~]# minikube start --vm-driver=none
Starting local Kubernetes v1.13.2 cluster...
Starting VM...
Getting VM IP address...
Moving files into cluster...
Setting up certs...
Connecting to cluster...
Setting up kubeconfig...
Stopping extra container runtimes...
Starting cluster components...
Verifying kubelet health ...
Verifying apiserver health ...
Kubectl is now configured to use the cluster.
===================
WARNING: IT IS RECOMMENDED NOT TO RUN THE NONE DRIVER ON PERSONAL WORKSTATIONS
	The 'none' driver will run an insecure kubernetes apiserver as root that may leave the host vulnerable to CSRF attacks

When using the none driver, the kubectl config and credentials generated will be root owned and will appear in the root home directory.
You will need to move the files to the appropriate location and then set the correct permissions.  An example of this is below:

	sudo mv /root/.kube $HOME/.kube # this will write over any previous configuration
	sudo chown -R $USER $HOME/.kube
	sudo chgrp -R $USER $HOME/.kube

	sudo mv /root/.minikube $HOME/.minikube # this will write over any previous configuration
	sudo chown -R $USER $HOME/.minikube
	sudo chgrp -R $USER $HOME/.minikube

This can also be done automatically by setting the env var CHANGE_MINIKUBE_NONE_USER=true
Loading cached images from config file.


Everything looks great. Please enjoy minikube!
			
			</pre>
		</div>
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp131"></a>2.1.4.5.Â http: server gave HTTP response to HTTPS client</h4></div></div></div>
			
			<p>é—®é¢˜åŸå› ï¼Œä½¿ç”¨ç§æœ‰ registry ç”±äºæ²¡æœ‰ HTTPS å¯¼è‡´ kubectl ä½¿ç”¨ https å»è®¿é—®ç§æœ‰ registry.</p>
			<pre class="screen">
			
Failed to pull image "192.168.3.85:5000/netkiller/config:latest": rpc error: code = Unknown desc = Error response from daemon: Get https://192.168.3.85:5000/v2/: http: server gave HTTP response to HTTPS client			
			
			</pre>
			<p>minikube å¹¶ä¸ä¼šä½¿ç”¨ docker é…ç½®æ–‡ä»¶ä¸­çš„ insecure-registry é…ç½®é¡¹</p>
			<p>è§£å†³åŠæ³•</p>
			<pre class="screen">
					
minikube start --insecure-registry=127.0.0.1:5000		
			
			</pre>
			<p>æˆ–æŒ‡å®šç½‘æ®µ</p>
			<pre class="screen">
			
minikube start --insecure-registry "10.0.0.0/24"			
			
			</pre>
		</div>
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp132"></a>2.1.4.6.Â provided port is not in the valid range. The range of valid ports is 30000-32767</h4></div></div></div>
			
			<pre class="screen">
			
iMac:kubernetes neo$ kubectl create -f redis/redis.yml 
configmap/redis-config created
deployment.apps/redis created
The Service "redis" is invalid: spec.ports[0].nodePort: Invalid value: 6379: provided port is not in the valid range. The range of valid ports is 30000-32767			
			
			</pre>
			<p>ç¼–è¾‘kube-apiserver.yamlæ–‡ä»¶</p>
			<pre class="screen">
			
$ minikube ssh
$ sudo vi /etc/kubernetes/manifests/kube-apiserver.yaml
			
			</pre>
			<p>å¢åŠ kube-apiserverçš„å¯åŠ¨é…ç½®é¡¹</p>
			<pre class="screen">
			
--service-node-port-range=1024-65535
			
			</pre>
			<p></p>
			<pre class="screen">
			
$ sudo cat /etc/kubernetes/manifests/kube-apiserver.yaml
apiVersion: v1
kind: Pod
metadata:
  annotations:
    kubeadm.kubernetes.io/kube-apiserver.advertise-address.endpoint: 192.168.64.5:8443
  creationTimestamp: null
  labels:
    component: kube-apiserver
    tier: control-plane
  name: kube-apiserver
  namespace: kube-system
spec:
  containers:
  - command:
    - kube-apiserver
    - --advertise-address=192.168.64.5
    - --allow-privileged=true
    - --authorization-mode=Node,RBAC
    - --client-ca-file=/var/lib/minikube/certs/ca.crt
    - --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,NodeRestriction,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota
    - --enable-bootstrap-token-auth=true
    - --etcd-cafile=/var/lib/minikube/certs/etcd/ca.crt
    - --etcd-certfile=/var/lib/minikube/certs/apiserver-etcd-client.crt
    - --etcd-keyfile=/var/lib/minikube/certs/apiserver-etcd-client.key
    - --etcd-servers=https://127.0.0.1:2379
    - --insecure-port=0
    - --kubelet-client-certificate=/var/lib/minikube/certs/apiserver-kubelet-client.crt
    - --kubelet-client-key=/var/lib/minikube/certs/apiserver-kubelet-client.key
    - --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname
    - --proxy-client-cert-file=/var/lib/minikube/certs/front-proxy-client.crt
    - --proxy-client-key-file=/var/lib/minikube/certs/front-proxy-client.key
    - --requestheader-allowed-names=front-proxy-client
    - --requestheader-client-ca-file=/var/lib/minikube/certs/front-proxy-ca.crt
    - --requestheader-extra-headers-prefix=X-Remote-Extra-
    - --requestheader-group-headers=X-Remote-Group
    - --requestheader-username-headers=X-Remote-User
    - --secure-port=8443
    - --service-account-key-file=/var/lib/minikube/certs/sa.pub
    - --service-cluster-ip-range=10.10.0.0/24
    - --service-node-port-range=1024-65535
    - --tls-cert-file=/var/lib/minikube/certs/apiserver.crt
    - --tls-private-key-file=/var/lib/minikube/certs/apiserver.key
    image: registry.cn-hangzhou.aliyuncs.com/google_containers/kube-apiserver:v1.19.2
    imagePullPolicy: IfNotPresent
    livenessProbe:
      failureThreshold: 8
      httpGet:
        host: 192.168.64.5
        path: /livez
        port: 8443
        scheme: HTTPS
      initialDelaySeconds: 10
      periodSeconds: 10
      timeoutSeconds: 15
    name: kube-apiserver
    readinessProbe:
      failureThreshold: 3
      httpGet:
        host: 192.168.64.5
        path: /readyz
        port: 8443
        scheme: HTTPS
      periodSeconds: 1
      timeoutSeconds: 15
    resources:
      requests:
        cpu: 250m
    startupProbe:
      failureThreshold: 24
      httpGet:
        host: 192.168.64.5
        path: /livez
        port: 8443
        scheme: HTTPS
      initialDelaySeconds: 10
      periodSeconds: 10
      timeoutSeconds: 15
    volumeMounts:
    - mountPath: /etc/ssl/certs
      name: ca-certs
      readOnly: true
    - mountPath: /var/lib/minikube/certs
      name: k8s-certs
      readOnly: true
    - mountPath: /usr/share/ca-certificates
      name: usr-share-ca-certificates
      readOnly: true
  hostNetwork: true
  priorityClassName: system-node-critical
  volumes:
  - hostPath:
      path: /etc/ssl/certs
      type: DirectoryOrCreate
    name: ca-certs
  - hostPath:
      path: /var/lib/minikube/certs
      type: DirectoryOrCreate
    name: k8s-certs
  - hostPath:
      path: /usr/share/ca-certificates
      type: DirectoryOrCreate
    name: usr-share-ca-certificates
status: {}			
			
			</pre>
			<p></p>
			<pre class="screen">
			
sudo systemctl restart kubelet			
			
			</pre>
		</div>
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp133"></a>2.1.4.7.Â Exiting due to MK_ENABLE: run callbacks: running callbacks: [verifying registry addon pods : timed out waiting for the condition: timed out waiting for the condition]</h4></div></div></div>
			
			<pre class="screen">
			
iMac:~ neo$ minikube addons enable registry
ğŸ”  Verifying registry addon...

âŒ  Exiting due to MK_ENABLE: run callbacks: running callbacks: [verifying registry addon pods : timed out waiting for the condition: timed out waiting for the condition]

ğŸ˜¿  If the above advice does not help, please let us know: 
ğŸ‘‰  https://github.com/kubernetes/minikube/issues/new/choose			
			
			</pre>
		</div>
	</div>
</div>

	

	


	


	



	

	

	


	

</div><div xmlns="" id="disqus_thread"></div><script xmlns="">

var disqus_config = function () {
this.page.url = "http://www.netkiller.cn";  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = 'netkiller'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = '//netkiller.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script><noscript xmlns="">Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><br xmlns="" /><script xmlns="" type="text/javascript" id="clustrmaps" src="//cdn.clustrmaps.com/map_v2.js?u=r5HG&amp;d=9mi5r_kkDC8uxG8HuY3p4-2qgeeVypAK9vMD-2P6BYM"></script><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="../docker/docker.faq.html">ä¸Šä¸€é¡µ</a>Â </td><td width="20%" align="center">Â </td><td width="40%" align="right">Â <a accesskey="n" href="microk8s.html">ä¸‹ä¸€é¡µ</a></td></tr><tr><td width="40%" align="left" valign="top">1.10.Â Docker FAQÂ </td><td width="20%" align="center"><a accesskey="h" href="../index.html">èµ·å§‹é¡µ</a></td><td width="40%" align="right" valign="top">Â 2.2.Â microk8s</td></tr></table></div><script xmlns="">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-11694057-1', 'auto');
  ga('send', 'pageview');

</script><script xmlns="" async="async">
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?93967759a51cda79e49bf4e34d0b0f2c";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script xmlns="" async="async">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script></body></html>