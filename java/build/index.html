<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>第 2 章 Build Tools</title><link rel="stylesheet" type="text/css" href="..//docbook.css" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><link rel="home" href="../index.html" title="Netkiller Java 手札" /><link rel="up" href="../index.html" title="Netkiller Java 手札" /><link rel="prev" href="../javax/crypto/index.html" title="1.12. Crypto" /><link rel="next" href="ivy.html" title="2.2. Apache Ivy" /></head><body><a xmlns="" href="//www.netkiller.cn/">Home</a> |
		<a xmlns="" href="//netkiller.github.io/">简体中文</a> |
	    <a xmlns="" href="http://netkiller.sourceforge.net/">繁体中文</a> |
	    <a xmlns="" href="/journal/index.html">杂文</a> |
	    <a xmlns="" href="//www.netkiller.cn/home/donations.html">打赏(Donations)</a> |
	    <a xmlns="" href="http://netkiller-github-com.iteye.com/">ITEYE 博客</a> |
	    <a xmlns="" href="http://my.oschina.net/neochen/">OSChina 博客</a> |
	    <a xmlns="" href="https://www.facebook.com/bg7nyt">Facebook</a> |
	    <a xmlns="" href="http://cn.linkedin.com/in/netkiller/">Linkedin</a> |
	    <a xmlns="" href="https://zhuanlan.zhihu.com/netkiller">知乎专栏</a> |
	    <a xmlns="" href="/search.html">Search</a> |
		<a xmlns="" href="mailto:netkiller@msn.com">Email</a><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">第 2 章 Build Tools</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="../javax/crypto/index.html">上一页</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="ivy.html">下一页</a></td></tr></table><hr /></div><table xmlns=""><tr><td><iframe src="//ghbtns.com/github-btn.html?user=netkiller&amp;repo=netkiller.github.io&amp;type=watch&amp;count=true&amp;size=large" height="30" width="170" frameborder="0" scrolling="0" style="width:170px; height: 30px;" allowTransparency="true"></iframe></td><td><iframe src="//ghbtns.com/github-btn.html?user=netkiller&amp;repo=netkiller.github.io&amp;type=fork&amp;count=true&amp;size=large" height="30" width="170" frameborder="0" scrolling="0" style="width:170px; height: 30px;" allowTransparency="true"></iframe></td><td><iframe src="//ghbtns.com/github-btn.html?user=netkiller&amp;type=follow&amp;count=true&amp;size=large" height="30" width="240" frameborder="0" scrolling="0" style="width:240px; height: 30px;" allowTransparency="true"></iframe></td></tr></table><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="index"></a>第 2 章 Build Tools</h1></div></div></div><div class="toc"><p><strong>目录</strong></p><dl class="toc"><dt><span class="section"><a href="index.html#ant">2.1. Apache Ant</a></span></dt><dd><dl><dt><span class="section"><a href="index.html#setup">2.1.1. 安装 ant</a></span></dt><dd><dl><dt><span class="section"><a href="index.html#idp44">2.1.1.1. 1.8</a></span></dt><dt><span class="section"><a href="index.html#idp45">2.1.1.2. 1.10.1</a></span></dt></dl></dd><dt><span class="section"><a href="index.html#cli">2.1.2. ANT</a></span></dt><dd><dl><dt><span class="section"><a href="index.html#idp46">2.1.2.1. ant.project.name</a></span></dt><dt><span class="section"><a href="index.html#idp47">2.1.2.2. 定义 </a></span></dt></dl></dd><dt><span class="section"><a href="index.html#project">2.1.3. Project</a></span></dt><dd><dl><dt><span class="section"><a href="index.html#idp48">2.1.3.1. property</a></span></dt><dt><span class="section"><a href="index.html#idp49">2.1.3.2. ant</a></span></dt><dt><span class="section"><a href="index.html#environment">2.1.3.3. environment</a></span></dt></dl></dd><dt><span class="section"><a href="index.html#path">2.1.4. path</a></span></dt><dt><span class="section"><a href="index.html#copy">2.1.5. copy</a></span></dt><dt><span class="section"><a href="index.html#javac">2.1.6. javac</a></span></dt><dt><span class="section"><a href="index.html#condition">2.1.7. condition</a></span></dt><dt><span class="section"><a href="index.html#exec">2.1.8. exec</a></span></dt><dd><dl><dt><span class="section"><a href="index.html#idp50">2.1.8.1. sshexec</a></span></dt></dl></dd><dt><span class="section"><a href="index.html#if">2.1.9. if</a></span></dt><dt><span class="section"><a href="index.html#macrodef">2.1.10. macrodef</a></span></dt><dd><dl><dt><span class="section"><a href="index.html#idp51">2.1.10.1. Git</a></span></dt><dt><span class="section"><a href="index.html#idp52">2.1.10.2. Rsync</a></span></dt><dt><span class="section"><a href="index.html#idp53">2.1.10.3. SSH</a></span></dt><dt><span class="section"><a href="index.html#maven">2.1.10.4. maven</a></span></dt></dl></dd><dt><span class="section"><a href="index.html#javascript">2.1.11. Javascript</a></span></dt><dt><span class="section"><a href="index.html#mail">2.1.12. mail</a></span></dt><dt><span class="section"><a href="index.html#basename">2.1.13. basename</a></span></dt><dt><span class="section"><a href="index.html#faq">2.1.14. FAQ</a></span></dt><dd><dl><dt><span class="section"><a href="index.html#idp54">2.1.14.1. warning: 'includeantruntime' was not set, defaulting to build.sysclasspath=last; set to false for repeatable builds</a></span></dt><dt><span class="section"><a href="index.html#idp55">2.1.14.2. 调试 exec</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="ivy.html">2.2. Apache Ivy</a></span></dt><dd><dl><dt><span class="section"><a href="ivy.html#idp58">2.2.1. Ivy Install</a></span></dt><dd><dl><dt><span class="section"><a href="ivy.html#idp56">2.2.1.1. source code</a></span></dt><dt><span class="section"><a href="ivy.html#idp57">2.2.1.2. apt-get</a></span></dt></dl></dd><dt><span class="section"><a href="ivy.html#idp59">2.2.2. Test example</a></span></dt></dl></dd><dt><span class="section"><a href="maven.html">2.3. maven</a></span></dt><dd><dl><dt><span class="section"><a href="maven.html#install">2.3.1. 安装</a></span></dt><dd><dl><dt><span class="section"><a href="maven.html#idp60">2.3.1.1. Ubuntu</a></span></dt><dt><span class="section"><a href="maven.html#idp61">2.3.1.2. 源码安装</a></span></dt></dl></dd><dt><span class="section"><a href="maven.html#cli">2.3.2. Maven 命令</a></span></dt><dd><dl><dt><span class="section"><a href="maven.html#help">2.3.2.1. help</a></span></dt><dt><span class="section"><a href="maven.html#create">2.3.2.2. archetype:create</a></span></dt><dt><span class="section"><a href="maven.html#clean">2.3.2.3. clean</a></span></dt><dt><span class="section"><a href="maven.html#compile">2.3.2.4. compile</a></span></dt><dt><span class="section"><a href="maven.html#test">2.3.2.5. test</a></span></dt><dt><span class="section"><a href="maven.html#package">2.3.2.6. package</a></span></dt><dt><span class="section"><a href="maven.html#install">2.3.2.7. install</a></span></dt><dt><span class="section"><a href="maven.html#war">2.3.2.8. war</a></span></dt><dt><span class="section"><a href="maven.html#exec">2.3.2.9. exec</a></span></dt><dt><span class="section"><a href="maven.html#dependency">2.3.2.10. dependency</a></span></dt><dt><span class="section"><a href="maven.html#jar">2.3.2.11. jar</a></span></dt><dt><span class="section"><a href="maven.html#help:describe">2.3.2.12. help:describe</a></span></dt></dl></dd><dt><span class="section"><a href="maven.html#mvnrepository">2.3.3. Maven 仓库</a></span></dt><dt><span class="section"><a href="maven.html#pom.xml">2.3.4. pom.xml</a></span></dt><dd><dl><dt><span class="section"><a href="maven.html#properties">2.3.4.1. properties</a></span></dt><dt><span class="section"><a href="maven.html#dependencies">2.3.4.2. dependencies</a></span></dt><dt><span class="section"><a href="maven.html#build">2.3.4.3. build</a></span></dt><dt><span class="section"><a href="maven.html#build">2.3.4.4. build</a></span></dt><dt><span class="section"><a href="maven.html#plugins">2.3.4.5. plugins</a></span></dt></dl></dd><dt><span class="section"><a href="maven.html#plugins">2.3.5. plugins</a></span></dt><dd><dl><dt><span class="section"><a href="maven.html#maven-compiler-plugin">2.3.5.1. maven-compiler-plugin</a></span></dt><dt><span class="section"><a href="maven.html#maven-war-plugin">2.3.5.2. maven-war-plugin</a></span></dt><dt><span class="section"><a href="maven.html#maven-antrun-plugin">2.3.5.3. maven-antrun-plugin</a></span></dt><dt><span class="section"><a href="maven.html#maven-install-plugin">2.3.5.4. maven-install-plugin</a></span></dt><dt><span class="section"><a href="maven.html#maven-surefire-plugin">2.3.5.5. maven-surefire-plugin</a></span></dt><dt><span class="section"><a href="maven.html#maven-jar-plugin">2.3.5.6. maven-jar-plugin</a></span></dt><dt><span class="section"><a href="maven.html#maven-dependency-plugin">2.3.5.7. maven-dependency-plugin</a></span></dt><dt><span class="section"><a href="maven.html#spring-boot-maven-plugin">2.3.5.8. spring-boot-maven-plugin</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="gradle.html">2.4. Gradle</a></span></dt><dd><dl><dt><span class="section"><a href="gradle.html#idp70">2.4.1. gradle 命令</a></span></dt><dd><dl><dt><span class="section"><a href="gradle.html#idp69">2.4.1.1. tasks 列出任务</a></span></dt></dl></dd><dt><span class="section"><a href="gradle.html#idp74">2.4.2. build.gradle</a></span></dt><dd><dl><dt><span class="section"><a href="gradle.html#idp71">2.4.2.1. repositories</a></span></dt><dt><span class="section"><a href="gradle.html#idp72">2.4.2.2. dependencies</a></span></dt><dt><span class="section"><a href="gradle.html#idp73">2.4.2.3. jar</a></span></dt></dl></dd><dt><span class="section"><a href="gradle.html#gradle.properties">2.4.3. gradle.properties</a></span></dt><dd><dl><dt><span class="section"><a href="gradle.html#idp75">2.4.3.1. 列出 properties</a></span></dt><dt><span class="section"><a href="gradle.html#idp76">2.4.3.2. 自定义 gradle.properties</a></span></dt><dt><span class="section"><a href="gradle.html#idp77">2.4.3.3. </a></span></dt><dt><span class="section"><a href="gradle.html#idp78">2.4.3.4. System.properties</a></span></dt></dl></dd><dt><span class="section"><a href="gradle.html#idp79">2.4.4. Example</a></span></dt></dl></dd></dl></div>
	
	
<div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ant"></a>2.1. Apache Ant</h2></div></div></div>
	
	<p><a class="ulink" href="http://ant.apache.org/" target="_top">http://ant.apache.org/</a></p>
	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="setup"></a>2.1.1. 安装 ant</h3></div></div></div>
		
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp44"></a>2.1.1.1. 1.8</h4></div></div></div>
			
			<pre class="screen">
cd /usr/local/src
wget http://mirror.bjtu.edu.cn/apache//ant/binaries/apache-ant-1.8.1-bin.tar.gz
tar zxvf apache-ant-1.8.1-bin.tar.gz
mv apache-ant-1.8.1 /usr/local/
cd ..
ln -s apache-ant-1.8.1 apache-ant
			</pre>
			<pre class="screen">
ANT_HOME=/usr/local/apache-ant
export CLASSPATH=$CLASSPATH:$ANT_HOME/lib
			</pre>
		</div>
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp45"></a>2.1.1.2. 1.10.1</h4></div></div></div>
			
			<p>Netkiller OSCM 一键安装</p>
			<pre class="screen">
curl -s https://raw.githubusercontent.com/oscm/shell/master/lang/java/ant/apache-ant-1.10.1.sh | bash
			</pre>
		</div>
	</div>
	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="cli"></a>2.1.2. ANT</h3></div></div></div>
		
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp46"></a>2.1.2.1. ant.project.name</h4></div></div></div>
			
			<p>ant.project.name 一般式定义在</p>
			<pre class="screen">
			
&lt;project name="www.netkiller.cn" default="compile" basedir="." xmlns:if="ant:if"&gt;
&lt;echo&gt;${ant.project.name}&lt;/echo&gt;
			
			</pre>
			<p>我们希望从命令行传递这个值</p>
			<pre class="screen">
			
&lt;project default="compile" basedir="." xmlns:if="ant:if"&gt;
&lt;echo&gt;${ant.project.name}&lt;/echo&gt;
			
			</pre>
			<p>你需要将 project 中的定义去掉才能从命令行传递</p>
			<pre class="screen">
			
ant -Dant.project.name=www.netkiller.cn -f build.xml
			
			</pre>
			<p>你也可以从 build.properties 文件定义 ant.project.name</p>
			<pre class="screen">
			
MacBook-Pro:deployment neo$ cat build.properties 
ant.project.name=www.netkiller.cn			
			
			</pre>
			<pre class="screen">
			
ant -f build.xml -propertyfile build.properties	
			
			</pre>
		</div>
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp47"></a>2.1.2.2. 定义 </h4></div></div></div>
			
			<pre class="screen">
			
			
			</pre>
		</div>
	</div>
	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="project"></a>2.1.3. Project</h3></div></div></div>
		
		<p></p>
		<pre class="screen">
		
&lt;description&gt;project Name&lt;/description&gt;
		
		</pre>
		
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp48"></a>2.1.3.1. property</h4></div></div></div>
			
			<p>在 build.xml 中定义 property</p>
			<pre class="screen">
			
&lt;property name="src" value="src"/&gt;
&lt;property name="dest" value="classes"/&gt;
&lt;property name="hello" value="hello.jar"/&gt;		
			
			</pre>
			<p>引用 properties 文件</p>
			<pre class="screen">
			
&lt;property file="build.properties" /&gt;
&lt;propety resource="build.properties"/&gt;
			
			</pre>
			<p>设置系统的环境变量为前缀</p>
			<pre class="screen">
			
&lt;property environment="env"/&gt; 
&lt;property name="tomcat.home" value="${env.CATALINA_HOME}"/&gt; 
			
			</pre>
	 		<p>命令行传值，使用-D参数是会覆盖build.xml中的先前定义的变量</p>
			<pre class="screen">
			
$ ant --help | grep property
  -D&lt;property&gt;=&lt;value&gt;   use value for given property
  -propertyfile &lt;name&gt;   load all properties from file with -D
  

	 		
			</pre>
		</div>
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp49"></a>2.1.3.2. ant</h4></div></div></div>
			
			<p>Project name</p>
			<pre class="screen">
			
${ant.project.name}
			
			</pre>
		</div>
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="environment"></a>2.1.3.3. environment</h4></div></div></div>
			
			<pre class="screen">
			
&lt;property environment="env"/&gt;
&lt;echo message="JAVA_HOME is set to = ${env.JAVA_HOME}" /&gt;			
			
			</pre>
		</div>
	</div>
	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="path"></a>2.1.4. path</h3></div></div></div>
		
		<p>定义</p>
		<pre class="screen">
		
	&lt;path id="classpath"&gt;  
        &lt;fileset dir="${env.JAVA_HOME}/lib"&gt;  
            &lt;include name="*.jar" /&gt;  
        &lt;/fileset&gt;  
        &lt;fileset dir="${env.CATALINA_HOME}/lib"&gt;  
            &lt;include name="*.jar" /&gt;  
        &lt;/fileset&gt;  
        &lt;fileset dir="WebRoot/WEB-INF/lib" includes="*.jar"/&gt;
    &lt;/path&gt;    
		
		</pre>
		<p>引用</p>
		<pre class="screen">
		
	&lt;javac srcdir="${src.dir}" destdir="${classes.dir}" source="1.5" target="1.5"&gt;  
		&lt;classpath refid="classpath" /&gt;  
	&lt;/javac&gt;		
		
		</pre>
		<p></p>
		<pre class="screen">
		
    &lt;classpath&gt;
		&lt;path refid="classpath"/&gt;
    &lt;/classpath&gt;		
		
		</pre>
	</div>
	
	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="copy"></a>2.1.5. copy</h3></div></div></div>
		
		<p>复制目录</p>
		<pre class="screen">
		
	&lt;copy todir="${basedir}/WebContent"&gt; 
		&lt;fileset dir="${basedir}/WebRoot" includes="**/*"/&gt;
	&lt;/copy&gt;	    
		
		</pre>
		<p>复制指定扩展名文件</p>
		<pre class="screen">
		
	&lt;copy todir="${dest}"&gt;  
		&lt;fileset dir="${src}"&gt;  
			&lt;include name="**/*.xml" /&gt;  
			&lt;include name="**/*.properties" /&gt;  
		&lt;/fileset&gt;
	&lt;/copy&gt; 	
		
		</pre>
	</div>
	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="javac"></a>2.1.6. javac</h3></div></div></div>
		
		<pre class="screen">
		
	&lt;path id="classpath"&gt;
		&lt;fileset dir="${env.JAVA_HOME}/lib"&gt;
			&lt;include name="*.jar" /&gt;
		&lt;/fileset&gt;
		&lt;fileset dir="${env.CATALINA_HOME}/lib"&gt;
			&lt;include name="*.jar" /&gt;
		&lt;/fileset&gt;
		&lt;fileset dir="${project.dir}/WebRoot/WEB-INF/lib" includes="*.jar" /&gt;
	&lt;/path&gt;

	&lt;javac srcdir="${project.src}" destdir="${project.build}/WEB-INF/classes" debug="true" listfiles="true"&gt;
			&lt;classpath refid="classpath" /&gt;
			&lt;include name="**/*.java"/&gt;
			&lt;exclude name="**/*.xml"/&gt;
			&lt;exclude name="**/*.properties"/&gt;
	&lt;/javac&gt;
		
		</pre>
		<p>listfiles 显示编译文件列表</p>
		<p>debug 显示调试信息，编译错误信息</p>
	</div>
	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="condition"></a>2.1.7. condition</h3></div></div></div>
		
		<p></p>
		<pre class="screen">
		
&lt;?xml version="1.0"?&gt;
&lt;project name="test" default="doFoo" basedir="."&gt;
  &lt;property name="directory" value="/www/directory"/&gt;

  &lt;target name="doFoo" depends="dir.check" if="dir.exists"&gt;
    &lt;echo&gt;${directory} exists&lt;/echo&gt;
  &lt;/target&gt;

  &lt;target name="doBar" depends="dir.check" unless="dir.exists"&gt;
    &lt;echo&gt;${directory} missing"&lt;/echo&gt;
  &lt;/target&gt;

  &lt;target name="dir.check"&gt;
    &lt;condition property="dir.exists"&gt;
      &lt;available file="${directory}" type="dir"/&gt;
    &lt;/condition&gt;
  &lt;/target&gt;
&lt;/project&gt;		
		
		</pre>		
	</div>
	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="exec"></a>2.1.8. exec</h3></div></div></div>
		
		<pre class="screen">
		
&lt;project name="{{ name }}" default="help" basedir="."&gt;
  
  &lt;property name="username" value="{{ username }}"/&gt;
  &lt;property name="host" value="{{ host }}"/&gt;
  &lt;property name="dir" value="/srv/{{ path }}/"/&gt;

  &lt;tstamp&gt;
    &lt;format property="TODAY_UK" pattern="yyyyMMddhhmmss" locale="en,UK"/&gt;
  &lt;/tstamp&gt;

  &lt;target name="help" description="show available commands" &gt;
    &lt;exec executable="ant" dir="." failonerror="true"&gt;
      &lt;arg value="-p"/&gt;
    &lt;/exec&gt;
  &lt;/target&gt;
  
  &lt;target name="deploy-to" description="show where we are deploying to" &gt;
    &lt;echo&gt;${username}@${host}:${dir}&lt;/echo&gt;
  &lt;/target&gt;

  &lt;target name="deploy" description="deploy usng rsync" &gt;
    &lt;exec executable="rsync" dir="." failonerror="true"&gt;
      &lt;arg value="-r"/&gt;
      &lt;arg value="."/&gt;
      &lt;arg value="${username}@${host}:${dir}"/&gt;
      &lt;arg value="--exclude-from=rsync.excludes"/&gt;
      &lt;arg value="-v"/&gt;
    &lt;/exec&gt;
  &lt;/target&gt;

  &lt;target name="deploy-test" description="test deploy usng rsync with the dry run flag set" &gt;
    &lt;exec executable="rsync" dir="." failonerror="true"&gt;
      &lt;arg value="-r"/&gt;
      &lt;arg value="."/&gt;
      &lt;arg value="${username}@${host}:${dir}"/&gt;
      &lt;arg value="--exclude-from=rsync.excludes"/&gt;
      &lt;arg value="--dry-run"/&gt;
      &lt;arg value="-v"/&gt;
    &lt;/exec&gt;
  &lt;/target&gt;

  &lt;target name="backup" description="backup site" &gt;
    &lt;exec executable="scp" dir="." failonerror="true"&gt;
      &lt;arg value="-r"/&gt;
      &lt;arg value="${username}@${host}:${dir}"/&gt;
      &lt;arg value="backups/${TODAY_UK}"/&gt;
    &lt;/exec&gt;
  &lt;/target&gt;

&lt;/project&gt;		
		
		</pre>
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp50"></a>2.1.8.1. sshexec</h4></div></div></div>
			
			<pre class="screen">
			
&lt;sshexec host="${remove}" keyfile="~/.ssh/id_rsa" command="/srv/apache-tomcat/bin/catalina.sh stop -force" /&gt;			
			
			</pre>
		</div>
	</div>
	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="if"></a>2.1.9. if</h3></div></div></div>
		
		<pre class="screen">
		
		
&lt;if&gt;
  &lt;available file="my_directory" type="dir" /&gt;
  &lt;then&gt;
    &lt;echo message="Directory exists" /&gt;
  &lt;/then&gt;
  &lt;else&gt;
    &lt;echo message="Directory does not exist" /&gt;
  &lt;/else&gt;
&lt;/if&gt;		
		
		
		</pre>
		<p>Ant 1.9.x 新增 xmlns:if="ant:if"</p>
		<pre class="screen">
		
&lt;project name="tryit"
 xmlns:if="ant:if"
 xmlns:unless="ant:unless"
&gt;
 &lt;exec executable="java"&gt;
   &lt;arg line="-X" if:true="${showextendedparams}"/&gt;
   &lt;arg line="-version" unless:true="${showextendedparams}"/&gt;
 &lt;/exec&gt;
 &lt;condition property="onmac"&gt;
   &lt;os family="mac"/&gt;
 &lt;/condition&gt;
 &lt;echo if:set="onmac"&gt;running on MacOS&lt;/echo&gt;
 &lt;echo unless:set="onmac"&gt;not running on MacOS&lt;/echo&gt;
&lt;/project&gt;


&lt;!DOCTYPE project&gt;
&lt;project xmlns:if="ant:if" xmlns:unless="ant:unless"&gt;
  &lt;property unless:set="property" name="property.is.set" value="false"/&gt;
  &lt;property if:set="property" name="property.is.set" value="true"/&gt;
  &lt;echo&gt;${property.is.set}&lt;/echo&gt;
&lt;/project&gt;
		
		</pre>
	</div>
	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="macrodef"></a>2.1.10. macrodef</h3></div></div></div>
		
		<p>arg value 与 arg line</p>
		<p>arg line 可以处理参数的空格， 而arg value则不能. arg line 可以处理空参数， arg value传递空参数会报错.</p>
		<pre class="screen">
		
&lt;exec executable = "sh" dir = "@{dir}"&gt;
	&lt;arg line = "ls -l /var/log" /&gt;
&lt;/exec&gt;


&lt;exec executable = "ls" dir = "@{dir}"&gt;
	&lt;arg value = "-l" /&gt;
	&lt;arg value = "/var/log" /&gt;
&lt;/exec&gt;
		
		</pre>
		<pre class="screen">
		
        &lt;macrodef name="mvn"&gt;
                &lt;attribute name="options" default="" /&gt;
                &lt;attribute name="goal" default="" /&gt;
                &lt;attribute name="phase" default=" " /&gt;
                &lt;attribute name="dir" default="" /&gt;
                &lt;element name="args" optional="false" /&gt;
                &lt;sequential&gt;
                        &lt;exec executable="mvn" dir="@{dir}" &gt;
                                &lt;arg value="@{options}" /&gt;
                                &lt;arg value="@{goal}" /&gt;
                                &lt;arg value="@{phase}" /&gt;
                        &lt;/exec&gt;
                &lt;/sequential&gt;
        &lt;/macrodef&gt;

&lt;!-- 执行下面宏将会出错，你必须传递options，phase参数 --&gt;
&lt;mvn goal="package" dir="${project.dir}"/&gt;
&lt;!-- 将vale改为line后正常 --&gt;
		&lt;exec executable="mvn" dir="@{dir}" &gt;
                                &lt;arg line="@{options}" /&gt;
                                &lt;arg line="@{goal}" /&gt;
                                &lt;arg line="@{phase}" /&gt;
        &lt;/exec&gt;
		
		
		</pre>
		<p>运行方式sequential为顺序执行， parallel为并行执行。</p>
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp51"></a>2.1.10.1. Git</h4></div></div></div>
			
			<pre class="screen">
			
&lt;macrodef name = "git"&gt;
    &lt;attribute name = "command" /&gt;
    &lt;attribute name = "dir" default = "" /&gt;
    &lt;element name = "args" optional = "true" /&gt;
    &lt;sequential&gt;
        &lt;echo message = "git @{command}" /&gt;
        &lt;exec executable = "git" dir = "@{dir}"&gt;
            &lt;arg value = "@{command}" /&gt;
            &lt;args/&gt;
        &lt;/exec&gt;
    &lt;/sequential&gt;
&lt;/macrodef&gt;
&lt;macrodef name = "git-clone-pull"&gt;
    &lt;attribute name = "repository" /&gt;
    &lt;attribute name = "dest" /&gt;
    &lt;sequential&gt;
        &lt;git command = "clone"&gt;
            &lt;args&gt;
                &lt;arg value = "@{repository}" /&gt;
                &lt;arg value = "@{dest}" /&gt;
            &lt;/args&gt;
        &lt;/git&gt;
        &lt;git command = "pull" dir = "@{dest}" /&gt;
    &lt;/sequential&gt;
&lt;/macrodef&gt;
			
			</pre>
			
			<pre class="screen">
			
&lt;git command = "clone"&gt;
    &lt;args&gt;
        &lt;arg value = "git://github.com/280north/ojunit.git" /&gt;
        &lt;arg value = "ojunit" /&gt;
    &lt;/args&gt;
&lt;/git&gt;

&lt;git command = "pull" dir = "repository_path" /&gt;		

&lt;git-clone-pull repository="git://github.com/280north/ojunit.git" dest="ojunit" /&gt;	
			
			</pre>
			
		</div>
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp52"></a>2.1.10.2. Rsync</h4></div></div></div>
			
			<pre class="screen">
			
			
	&lt;macrodef name="rsync"&gt;
		&lt;attribute name="option" default="auzv" /&gt;
		&lt;attribute name="src" default="" /&gt;
		&lt;attribute name="dest" default="" /&gt;
		&lt;element name="args" optional="true" /&gt;
		&lt;sequential&gt;
			&lt;exec executable="rsync"&gt;
				&lt;arg value="@{option}" /&gt;
				&lt;arg value="@{src}" /&gt;
				&lt;arg value="@{dest}" /&gt;
				&lt;args /&gt;
			&lt;/exec&gt;
		&lt;/sequential&gt;
	&lt;/macrodef&gt;			
			
			
			</pre>
			<pre class="screen">
			
	&lt;target name="deploy" depends="compile"&gt;
		&lt;rsync option="-auzv" src="${project.dest}" dest="${remote}:${destination}"&gt;
			&lt;args&gt;
				&lt;arg value="-P" /&gt;
			&lt;/args&gt;
		&lt;/rsync&gt;
	&lt;/target&gt;			
			
			</pre>
			
		</div>
		
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp53"></a>2.1.10.3. SSH</h4></div></div></div>
			
			<pre class="screen">
			
	&lt;macrodef name="ssh"&gt;
		&lt;attribute name="host" /&gt;
		&lt;attribute name="command" /&gt;
		&lt;attribute name="keyfile" default="~/.ssh/id_rsa" /&gt;
		&lt;element name="args" optional="true" /&gt;
		&lt;sequential&gt;
			&lt;exec executable="ssh"&gt;
				&lt;arg value="@{host}" /&gt;
				&lt;!-- arg value="-i @{keyfile}" / --&gt;
				&lt;args /&gt;
				&lt;arg value="@{command}" /&gt;
			&lt;/exec&gt;
		&lt;/sequential&gt;
	&lt;/macrodef&gt;
			
			</pre>
			<pre class="screen">
			
	&lt;target name="stop" depends=""&gt;
		&lt;!-- ssh host="${remote}" command="/srv/apache-tomcat/bin/catalina.sh stop -force" keyfile="~/.ssh/id_rsa" / --&gt;
		&lt;ssh host="${remote}" command="/srv/apache-tomcat/bin/shutdown.sh" /&gt;
	&lt;/target&gt;
	&lt;target name="start" depends=""&gt;
		&lt;ssh host="${remote}" command="/srv/apache-tomcat/bin/startup.sh" keyfile="~/.ssh/id_rsa" /&gt;
	&lt;/target&gt;		
			
			</pre>
			
		</div>
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="maven"></a>2.1.10.4. maven</h4></div></div></div>
			
			<pre class="screen">
			
        &lt;macrodef name="mvn"&gt;
                &lt;attribute name="options" default="" /&gt;
                &lt;attribute name="goal" default="" /&gt;
                &lt;attribute name="phase" default=" " /&gt;
                &lt;attribute name="dir" default="" /&gt;
                &lt;element name="args" optional="false" /&gt;
                &lt;sequential&gt;
                        &lt;exec executable="mvn" dir="@{dir}" &gt;
                                &lt;arg line="@{options}" /&gt;
                                &lt;arg value="@{goal}" /&gt;
                                &lt;arg line="@{phase}" /&gt;
                        &lt;/exec&gt;
                &lt;/sequential&gt;
        &lt;/macrodef&gt;			
			
			</pre>
		</div>
	</div>
	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="javascript"></a>2.1.11. Javascript</h3></div></div></div>
		
		<pre class="screen">
		

$ cat build.xml 
&lt;project name="Attachments" default="print"&gt;
    &lt;property name="numAttachments" value="20" /&gt;
    &lt;target name="generate"&gt;
        &lt;script language="javascript"&gt;&lt;![CDATA[
            var list = '1';
            var limit = project.getProperty( "numAttachments" );
            for (var i=2;i&lt;limit;i++)
            { 
                list = list + ',' + i;
            }
            project.setNewProperty("list", list);            
		print(list);
        ]] &gt;
        &lt;/script&gt;    
    &lt;/target&gt;
&lt;/project&gt;

		
		</pre>
		<pre class="screen">
		
$ ant generate
Buildfile: /www/testing/build.xml

generate:
   [script] 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19

BUILD SUCCESSFUL
Total time: 0 seconds
		
		</pre>
	</div>
	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="mail"></a>2.1.12. mail</h3></div></div></div>
		
		<p>https://ant.apache.org/manual/Tasks/mail.html</p>
		<pre class="screen">
		
cp ~/.m2/repository/com/sun/mail/javax.mail/1.5.6/javax.mail-1.5.6.jar /srv/apache-ant-1.9.6/lib
cp /www/.m2/repository/com/sun/mail/javax.mail/1.5.6/javax.mail-1.5.6.jar /srv/apache-ant-1.10.1/lib/
		
		</pre>
		<p>Examples</p>
		<pre class="screen">
		
&lt;mail from="me"
      tolist="you"
      subject="Results of nightly build"
      files="build.log"/&gt;
Sends an email from me to you with a subject of Results of nightly build and includes the contents of the file build.log in the body of the message.

&lt;mail mailhost="smtp.myisp.com" mailport="1025" subject="Test build"&gt;
  &lt;from address="config@myisp.com"/&gt;
  &lt;replyto address="me@myisp.com"/&gt;
  &lt;to address="all@xyz.com"/&gt;
  &lt;message&gt;The ${buildname} nightly build has completed&lt;/message&gt;
  &lt;attachments&gt;
    &lt;fileset dir="dist"&gt;
      &lt;include name="**/*.zip"/&gt;
    &lt;/fileset&gt;
  &lt;/attachments&gt;
&lt;/mail&gt;
		
		</pre>
	</div>
	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="basename"></a>2.1.13. basename</h3></div></div></div>
		
		<pre class="screen">
		
&lt;basename property="jar.filename" file="${lib.jarfile}"/&gt;
will set jar.filename to myjar.jar, if lib.jarfile is defined as either a full-path filename (eg., /usr/local/lib/myjar.jar), a relative-path filename (eg., lib/myjar.jar), or a simple filename (eg., myjar.jar).
&lt;basename property="cmdname" file="D:/usr/local/foo.exe"
          suffix=".exe"/&gt;
will set cmdname to foo.
&lt;property environment="env"/&gt;
&lt;basename property="temp.dirname" file="${env.TEMP}"/&gt;
			
		
		</pre>
	</div>
	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="faq"></a>2.1.14. FAQ</h3></div></div></div>
		
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp54"></a>2.1.14.1. warning: 'includeantruntime' was not set, defaulting to build.sysclasspath=last; set to false for repeatable builds</h4></div></div></div>
			
			<p>includeantruntime="false"</p>
			<pre class="screen">
			
&lt;target name="compile" depends="init"&gt;
   &lt;javac includeantruntime="false" srcdir="${src}" destdir="${dest}"/&gt;
&lt;/target&gt;
			
			</pre>
			<p>or</p>
			<pre class="screen">
			
&lt;property name="build.sysclasspath" value="last"/&gt;
			
			</pre>
		</div>
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp55"></a>2.1.14.2. 调试 exec</h4></div></div></div>
			
			<p>将 executable="echo" 设置成 echo 是一种不错的调试手段</p>
			<pre class="screen">
			
        &lt;macrodef name="gulp"&gt;
                &lt;attribute name="stage" default=""/&gt;
                &lt;attribute name="src" default=""/&gt;
                &lt;attribute name="dir" default="" /&gt;
                &lt;sequential&gt;
                        &lt;exec vmlauncher="false" executable="echo" dir="@{dir}" osfamily="unix"&gt;
                                &lt;arg line="--stage @{stage} --src @{src}"/&gt;
                                &lt;!-- arg value="stage @{stage}" / --&gt;
                        &lt;/exec&gt;
                &lt;/sequential&gt;
        &lt;/macrodef&gt;

        &lt;target name="gulp"&gt;
                &lt;gulp stage="${git.branch}" src="cn" dir="."/&gt;
        &lt;/target&gt;
			
			</pre>
		</div>
	</div>
</div>




	

	

</div><div xmlns="" id="disqus_thread"></div><script xmlns="">

var disqus_config = function () {
this.page.url = "http://www.netkiller.cn";  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = 'netkiller'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = '//netkiller.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script><noscript xmlns="">Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><br xmlns="" /><script xmlns="" type="text/javascript" id="clustrmaps" src="//cdn.clustrmaps.com/map_v2.js?u=r5HG&amp;d=9mi5r_kkDC8uxG8HuY3p4-2qgeeVypAK9vMD-2P6BYM"></script><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="../javax/crypto/index.html">上一页</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="ivy.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">1.12. Crypto </td><td width="20%" align="center"><a accesskey="h" href="../index.html">起始页</a></td><td width="40%" align="right" valign="top"> 2.2. Apache Ivy</td></tr></table></div><script xmlns="">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-11694057-1', 'auto');
  ga('send', 'pageview');

</script><script xmlns="" async="async">
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?93967759a51cda79e49bf4e34d0b0f2c";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script xmlns="" async="async">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script><script xmlns="" type="text/javascript" src="/js/q.js" async="async"></script></body></html>