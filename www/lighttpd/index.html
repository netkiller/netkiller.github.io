<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>第 2 章 Lighttpd</title><link rel="stylesheet" type="text/css" href="..//docbook.css" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><meta name="keywords" content="lamp,lnmp,famp,fnmp, cgi,fastcgi,wsgi, apache,lighttpd,nginx,tomcat, awstatus, webalizer" /><link rel="home" href="../index.html" title="Netkiller Linux Web 手札" /><link rel="up" href="../index.html" title="Netkiller Linux Web 手札" /><link rel="prev" href="../httpd/error.html" title="1.5. Error Prompt" /><link rel="next" href="lighttpd.config.html" title="2.2. /etc/lighttpd/lighttpd.conf" /></head><body><a xmlns="" href="http://www.netkiller.cn/">Home</a> |
		<a xmlns="" href="http://netkiller.github.io/">简体中文</a> |
	    <a xmlns="" href="http://netkiller.sourceforge.net/">繁体中文</a> |
	    <a xmlns="" href="/journal/index.html">杂文</a> |
	    <a xmlns="" href="/search.html">Search</a> |
	    <a xmlns="" href="http://netkiller-github-com.iteye.com/">ITEYE 博客</a> |
	    <a xmlns="" href="http://my.oschina.net/neochen/">OSChina 博客</a> |
	    <a xmlns="" href="https://www.facebook.com/bg7nyt">Facebook</a> |
	    <a xmlns="" href="http://cn.linkedin.com/in/netkiller/">Linkedin</a> |
		<a xmlns="" href="mailto:netkiller@msn.com">Email</a><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">第 2 章 Lighttpd</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="../httpd/error.html">上一页</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="lighttpd.config.html">下一页</a></td></tr></table><hr /></div><table xmlns=""><tr><td><iframe src="http://ghbtns.com/github-btn.html?user=netkiller&amp;repo=netkiller.github.com&amp;type=watch&amp;count=true&amp;size=large" height="30" width="170" frameborder="0" scrolling="0" style="width:170px; height: 30px;" allowTransparency="true"></iframe></td><td><iframe src="http://ghbtns.com/github-btn.html?user=netkiller&amp;repo=netkiller.github.com&amp;type=fork&amp;count=true&amp;size=large" height="30" width="170" frameborder="0" scrolling="0" style="width:170px; height: 30px;" allowTransparency="true"></iframe></td><td><iframe src="http://ghbtns.com/github-btn.html?user=netkiller&amp;type=follow&amp;count=true&amp;size=large" height="30" width="240" frameborder="0" scrolling="0" style="width:240px; height: 30px;" allowTransparency="true"></iframe></td></tr></table><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="index"></a>第 2 章 Lighttpd</h1></div></div></div><div class="toc"><p><strong>目录</strong></p><dl class="toc"><dt><span class="section"><a href="index.html#lighttpd.install">2.1. 安装Lighttpd</a></span></dt><dd><dl><dt><span class="section"><a href="index.html#lighttpd.install.apt-get">2.1.1. quick install with aptitude</a></span></dt><dt><span class="section"><a href="index.html#lighttpd.install.yum">2.1.2. yum install</a></span></dt><dt><span class="section"><a href="index.html#lighttpd.compile">2.1.3. to compile and then install lighttpd</a></span></dt><dd><dl><dt><span class="section"><a href="index.html#idm46180572471296">2.1.3.1. shell script</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="lighttpd.config.html">2.2. /etc/lighttpd/lighttpd.conf</a></span></dt><dd><dl><dt><span class="section"><a href="lighttpd.config.html#lighttpd.server.max-fds">2.2.1. max-worker / max-fds</a></span></dt><dt><span class="section"><a href="lighttpd.config.html#lighttpd.accesslog.filename">2.2.2. accesslog.filename</a></span></dt><dt><span class="section"><a href="lighttpd.config.html#lighttpd.etags">2.2.3. ETags</a></span></dt><dt><span class="section"><a href="lighttpd.config.html#lighttpd.server.tag">2.2.4. server.tag</a></span></dt></dl></dd><dt><span class="section"><a href="module.html">2.3. Module</a></span></dt><dd><dl><dt><span class="section"><a href="module.html#mod_simple_vhost">2.3.1. simple_vhost</a></span></dt><dt><span class="section"><a href="module.html#ssl">2.3.2. ssl</a></span></dt><dt><span class="section"><a href="module.html#redirect">2.3.3. redirect</a></span></dt><dt><span class="section"><a href="module.html#rewrite">2.3.4. rewrite</a></span></dt><dd><dl><dt><span class="section"><a href="module.html#rewrite.qsa">2.3.4.1. Lighttpd Rewrite QSA</a></span></dt></dl></dd><dt><span class="section"><a href="module.html#alias">2.3.5. alias</a></span></dt><dt><span class="section"><a href="module.html#auth">2.3.6. auth</a></span></dt><dt><span class="section"><a href="module.html#compress">2.3.7. compress</a></span></dt><dt><span class="section"><a href="module.html#expire">2.3.8. expire</a></span></dt><dt><span class="section"><a href="module.html#status">2.3.9. status</a></span></dt><dt><span class="section"><a href="module.html#setenv">2.3.10. setenv</a></span></dt><dd><dl><dt><span class="section"><a href="module.html#idm46180572431568">2.3.10.1. Automatic Decompression</a></span></dt></dl></dd><dt><span class="section"><a href="module.html#fastcgi">2.3.11. fastcgi</a></span></dt><dd><dl><dt><span class="section"><a href="module.html#idm46180572429920">2.3.11.1. enable fastcgi</a></span></dt><dt><span class="section"><a href="module.html#fastcgi.php">2.3.11.2. PHP</a></span></dt><dt><span class="section"><a href="module.html#fastcgi.python">2.3.11.3. Python</a></span></dt><dt><span class="section"><a href="module.html#fastcgi.perl">2.3.11.4. Perl</a></span></dt><dt><span class="section"><a href="module.html#fastcgi.ruby">2.3.11.5. Ruby</a></span></dt><dt><span class="section"><a href="module.html#idm46180572391168">2.3.11.6. UNIX domain sockets</a></span></dt></dl></dd><dt><span class="section"><a href="module.html#user-agent">2.3.12. user-agent</a></span></dt><dt><span class="section"><a href="module.html#ngx_http_spdy_module">2.3.13. spdy</a></span></dt></dl></dd><dt><span class="section"><a href="other.html">2.4. 其他模块</a></span></dt><dd><dl><dt><span class="section"><a href="other.html#mod_secdownload">2.4.1. mod_secdownload 防盗链</a></span></dt></dl></dd><dt><span class="section"><a href="lighttpd.example.html">2.5. Example</a></span></dt><dd><dl><dt><span class="section"><a href="lighttpd.example.html#idm46180572385104">2.5.1. s-maxage</a></span></dt></dl></dd></dl></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="lighttpd.install"></a>2.1. 安装Lighttpd</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="lighttpd.install.apt-get"></a>2.1.1. quick install with aptitude</h3></div></div></div><p>if you OS is Ubuntu/Debian </p><span class="command"><strong>apt-get install lighttpd</strong></span><pre class="screen">
netkiller@shenzhen:~$ sudo apt-get install lighttpd
		</pre><p>the config file in /etc/lighttpd</p><pre class="screen">
netkiller@shenzhen:~/document/Docbook/Linux$ find /etc/lighttpd/
/etc/lighttpd/
/etc/lighttpd/lighttpd.conf
/etc/lighttpd/conf-enabled
/etc/lighttpd/conf-available
/etc/lighttpd/conf-available/10-userdir.conf
/etc/lighttpd/conf-available/10-fastcgi.conf
/etc/lighttpd/conf-available/10-cgi.conf
/etc/lighttpd/conf-available/README
/etc/lighttpd/conf-available/10-ssl.conf
/etc/lighttpd/conf-available/10-proxy.conf
/etc/lighttpd/conf-available/10-auth.conf
/etc/lighttpd/conf-available/10-simple-vhost.conf
/etc/lighttpd/conf-available/10-ssi.conf
		</pre><p>Enabling and disabling modules could be done by provided e.g.</p><pre class="screen">
/usr/sbin/lighty-enable-mod fastcgi
/usr/sbin/lighty-disable-mod fastcgi
		</pre><p>when you enabled a mod please force-reload it</p><pre class="screen">
netkiller@shenzhen:/etc/lighttpd$ sudo lighty-enable-mod fastcgi
Available modules: auth cgi fastcgi proxy simple-vhost ssi ssl userdir
Already enabled modules: userdir
Enabling fastcgi: ok
Run /etc/init.d/lighttpd force-reload to enable changes
netkiller@shenzhen:/etc/lighttpd$ sudo /etc/init.d/lighttpd force-reload
 * Stopping web server lighttpd                                                                                                                                                                                                                                                                                       [ OK ]
 * Starting web server lighttpd
		</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="lighttpd.install.yum"></a>2.1.2. yum install</h3></div></div></div><pre class="screen">
# yum install lighttpd lighttpd-fastcgi -y
# chkconfig lighttpd on
		</pre><p>创建缓存目录</p><pre class="screen">
# mkdir -p /var/cache/lighttpd/compress
# chown lighttpd:lighttpd -R /var/cache/lighttpd
		</pre><p>禁用ipv6</p><pre class="screen">
# vim /etc/lighttpd/lighttpd.conf

#server.use-ipv6 = "enable"
		</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="lighttpd.compile"></a>2.1.3. to compile and then install lighttpd</h3></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>下载相关软件</p><p><a class="ulink" href="http://www.lighttpd.net/download/lighttpd-1.4.15.tar.gz" target="_top">立即下载</a></p><pre class="screen">
$ sudo apt-get install libpcre3*

cd /usr/local/src/
wget http://www.lighttpd.net/download/lighttpd-1.4.15.tar.gz
tar zxvf lighttpd-1.4.15.tar.gz
cd lighttpd-1.4.15
				</pre></li><li class="listitem"><p>编译安装</p><pre class="screen">
./configure --prefix=/usr/local/lighttpd-1.4.15 \
--with-bzip2 \
--with-memcache
make
make install
				</pre></li><li class="listitem"><p>创建目录与配置文件</p><pre class="screen">
ln -s /usr/local/lighttpd-1.4.15/ /usr/local/lighttpd
mkdir -p /www/pages
mkdir /www/logs
mkdir /usr/local/lighttpd/htdocs
mkdir /usr/local/lighttpd/logs
mkdir /usr/local/lighttpd/etc
cp ./doc/lighttpd.conf /usr/local/lighttpd/etc/
cd /usr/local/lighttpd/
				</pre></li><li class="listitem"><p>配置lighttpd.conf</p><span class="command"><strong>vi etc/lighttpd.conf</strong></span><p>找到 server.modules</p><p>删除 mod_fastcgi 前的注释</p><p>跟据你的需求修改下面定义</p><p>server.document-root = "/usr/local/lighttpd/htdocs/"</p><p>server.errorlog  = "/usr/local/lighttpd/logs/lighttpd.error.log"</p><p>accesslog.filename = "/usr/local/lighttpd/logs/access.log"</p><p>注释 $HTTP["url"]</p><pre class="screen">
#$HTTP["url"] =~ "\.pdf$" {
#  server.range-requests = "disable"
#}
				</pre></li><li class="listitem"><p>运行lighttpd</p><pre class="screen">
/usr/local/lighttpd/sbin/lighttpd -f /usr/local/lighttpd/etc/lighttpd.conf
				</pre><p>测试</p><p>curl http://ip/ 因为/www/pages/下没有HTML页面所以返回:</p><p>404 - Not Found</p></li></ol></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idm46180572471296"></a>2.1.3.1. shell script</h4></div></div></div><p>lighttpd script</p><div class="example"><a id="idm46180572470624"></a><p class="title"><strong>例 2.1. /etc/init.d/lighttpd</strong></p><div class="example-contents"><pre class="screen">
					
#!/bin/bash
# lighttpd init file for web server
#
# chkconfig: - 100 100
# description: Security, speed, compliance, and flexibility--all of these describe LightTPD which is rapidly redefining efficiency of a webserver;
#				as it is designed and optimized for high performance environments.
# author: Neo Chen&lt;openunix@163.com&gt;
#
# processname: $PROG
# config:
# pidfile: /var/run/lighttpd

# source function library
. /etc/init.d/functions

PREFIX=/usr/local/lighttpd
PROG=$PREFIX/sbin/lighttpd
OPTIONS="-f /usr/local/lighttpd/etc/lighttpd.conf"
USER=daemon
RETVAL=0
prog="lighttpd"

start() {
        echo -n $"Starting $prog: "
        if [ $UID -ne 0 ]; then
                RETVAL=1
                failure
        else
                daemon --user=$USER $PROG $OPTIONS
                RETVAL=$?
                [ $RETVAL -eq 0 ] &amp;&amp; touch /var/lock/subsys/lighttpd
        fi;
        echo
        return $RETVAL
}

stop() {
        echo -n $"Stopping $prog: "
        if [ $UID -ne 0 ]; then
                RETVAL=1
                failure
        else
                killproc $PROG
                RETVAL=$?
                [ $RETVAL -eq 0 ] &amp;&amp; rm -f /var/lock/subsys/lighttpd
        fi;
        echo
        return $RETVAL
}

reload(){
        echo -n $"Reloading $prog: "
        killproc $PROG -HUP
        RETVAL=$?
        echo
        return $RETVAL
}

restart(){
	stop
	start
}

condrestart(){
    [ -e /var/lock/subsys/lighttpd ] &amp;&amp; restart
    return 0
}

case "$1" in
  start)
	start
	;;
  stop)
	stop
	;;
  restart)
	restart
        ;;
  reload)
	reload
        ;;
  condrestart)
	condrestart
	;;
  status)
        status lighttpd
	RETVAL=$?
        ;;
  *)
	echo $"Usage: $0 {start|stop|status|restart|condrestart|reload}"
	RETVAL=1
esac

exit $RETVAL
					
					</pre></div></div><br class="example-break" /></div></div></div></div><div xmlns="" id="disqus_thread"></div><script xmlns="" type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */

            //if(document.domain == 'netkiller.github.com'){
            var disqus_shortname = 'netkiller'; // required: replace example with your forum shortname
            //}else{
			//var disqus_shortname = 'neochan';
            //}

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script><noscript xmlns="">Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><a xmlns="" href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a><br xmlns="" /><script xmlns="" type="text/javascript" id="clustrmaps" src="//cdn.clustrmaps.com/map_v2.js?u=r5HG&amp;d=9mi5r_kkDC8uxG8HuY3p4-2qgeeVypAK9vMD-2P6BYM"></script><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="../httpd/error.html">上一页</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="lighttpd.config.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">1.5. Error Prompt </td><td width="20%" align="center"><a accesskey="h" href="../index.html">起始页</a></td><td width="40%" align="right" valign="top"> 2.2. /etc/lighttpd/lighttpd.conf</td></tr></table></div><script xmlns="">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-11694057-1', 'auto');
  ga('send', 'pageview');

</script><script xmlns="" type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F997cd4a7320a82d72cb74d179118f697' type='text/javascript'%3E%3C/script%3E"));
</script><script xmlns="" type="text/javascript" src="/js/q.js"></script></body></html>