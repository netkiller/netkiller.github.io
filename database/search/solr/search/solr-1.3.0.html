<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>22.6. Solr 1.3.0</title><link rel="stylesheet" type="text/css" href="../../..//docbook.css" /><meta name="generator" content="DocBook XSL Stylesheets V1.79.1" /><meta name="keywords" content="MySQL, PostgreSQL, Oracle, NoSQL, ER, TokyoCabinet/Tyrant, Memcache, Membase, Redis, Flare, Voldemort, LevelDB, MongoDB, GreenSQL, RDBMS, ORDBMS" /><link rel="home" href="../../../index.html" title="Netkiller Database 手札" /><link rel="up" href="../index.html" title="第 22 章 Solr" /><link rel="prev" href="../faq.html" title="22.5. FAQ" /><link rel="next" href="../../elasticsearch/index.html" title="第 23 章 Elasticsearch" /></head><body><a xmlns="" href="//www.netkiller.cn/">Home</a> |
		<a xmlns="" href="//netkiller.github.io/">简体中文</a> |
	    <a xmlns="" href="http://netkiller.sourceforge.net/">繁体中文</a> |
	    <a xmlns="" href="/journal/index.html">杂文</a> |
	    <a xmlns="" href="//www.netkiller.cn/home/donations.html">打赏(Donations)</a> |
	    <a xmlns="" href="http://netkiller-github-com.iteye.com/">ITEYE 博客</a> |
	    <a xmlns="" href="http://my.oschina.net/neochen/">OSChina 博客</a> |
	    <a xmlns="" href="https://www.facebook.com/bg7nyt">Facebook</a> |
	    <a xmlns="" href="http://cn.linkedin.com/in/netkiller/">Linkedin</a> |
	    <a xmlns="" href="https://zhuanlan.zhihu.com/netkiller">知乎专栏</a> |
	    <a xmlns="" href="/search.html">Search</a> |
		<a xmlns="" href="mailto:netkiller@msn.com">Email</a><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">22.6. Solr 1.3.0</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="../faq.html">上一页</a> </td><th width="60%" align="center">第 22 章 Solr</th><td width="20%" align="right"> <a accesskey="n" href="../../elasticsearch/index.html">下一页</a></td></tr></table><hr /></div><table xmlns=""><tr><td><iframe src="//ghbtns.com/github-btn.html?user=netkiller&amp;repo=netkiller.github.io&amp;type=watch&amp;count=true&amp;size=large" height="30" width="170" frameborder="0" scrolling="0" style="width:170px; height: 30px;" allowTransparency="true"></iframe></td><td><iframe src="//ghbtns.com/github-btn.html?user=netkiller&amp;repo=netkiller.github.io&amp;type=fork&amp;count=true&amp;size=large" height="30" width="170" frameborder="0" scrolling="0" style="width:170px; height: 30px;" allowTransparency="true"></iframe></td><td><iframe src="//ghbtns.com/github-btn.html?user=netkiller&amp;type=follow&amp;count=true&amp;size=large" height="30" width="240" frameborder="0" scrolling="0" style="width:240px; height: 30px;" allowTransparency="true"></iframe></td></tr></table><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="solr-1.3.0"></a>22.6. Solr 1.3.0</h2></div></div></div>
	
	<p>http://lucene.apache.org/solr/</p>
	<p>java 采用apt-get安装</p>
	<div class="example"><a id="idp153"></a><p class="title"><strong>例 22.2. /etc/profile.d/java.sh</strong></p><div class="example-contents">
		
		<pre class="screen">
################################################
### Java environment by neo
################################################
export JAVA_HOME=/usr
export JRE_HOME=/usr
export PATH=$PATH:/usr/local/apache-tomcat/bin/:/usr/local/jetty-6.1.18/bin
export CLASSPATH="./:/usr/share/java/:/usr/local/apache-solr/example/multicore/lib"
export JAVA_OPTS="-Xms128m -Xmx1024m"
		</pre>
	</div></div><br class="example-break" />
	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="solr.embedded.jetty"></a>22.6.1. Embedded Jetty</h3></div></div></div>
		
		<pre class="screen">
		
wget http://apache.freelamp.com/lucene/solr/1.3.0/apache-solr-1.3.0.tgz
tar zxvf apache-solr-1.3.0.tgz
ln -s apache-solr-1.3.0 ../apache-solr
cd ../apache-solr/example/
java -jar start.jar
		
		</pre>
		<p>multicore: java -Dsolr.solr.home=multicore -jar start.jar</p>
	</div>
	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="solr.jetty"></a>22.6.2. Jetty</h3></div></div></div>
		
		<p>http://jetty.mortbay.org/jetty/</p>
		<div class="procedure"><a id="idp181"></a><p class="title"><strong>过程 22.1. apt-get install</strong></p><ol class="procedure" type="1"><li class="step">
				<p>install</p>
				<pre class="screen">
				
$ sudo apt-get install libxpp3-java
$ sudo apt-get install solr-jetty
				
				</pre>
			</li><li class="step">
				<p>firewall</p>
				<pre class="screen">
				
$ sudo ufw allow 8280
				
				</pre>
			</li><li class="step">
				<p>Testing.</p>
				<p>http://172.16.0.1:8280/</p>
				<p>http://172.16.0.1:8280/admin/ (user:admin, passwd:admin)</p>
			</li></ol></div>
		<div class="procedure"><a id="idp182"></a><p class="title"><strong>过程 22.2. source codes install</strong></p><ul class="procedure"><li class="step">
				<p>download</p>
				<pre class="screen">
				
wget http://dist.codehaus.org/jetty/jetty-6.1.18/jetty-6.1.18.zip
				
				</pre>
			</li></ul></div>
	</div>
	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="solr.tomcat"></a>22.6.3. Tomcat</h3></div></div></div>
		
		<p>http://tomcat.apache.org/</p>
		<div class="procedure"><ol class="procedure" type="1"><li class="step">
				<p>download</p>
				<pre class="screen">
				
cd /usr/local/src

wget http://apache.etoak.com/tomcat/tomcat-6/v6.0.20/bin/apache-tomcat-6.0.20.tar.gz
wget http://apache.freelamp.com/lucene/solr/1.3.0/apache-solr-1.3.0.tgz

tar zxvf apache-tomcat-6.0.20.tar.gz
ln -s apache-tomcat-6.0.20 ../apache-tomcat

tar zxvf apache-solr-1.3.0.tgz
ln -s apache-solr-1.3.0 ../apache-solr
				
				</pre>
			</li><li class="step">
				<p>solr.xml</p>
				<pre class="screen">
				
vim /usr/local/apache-tomcat/conf/Catalina/localhost/solr.xml

&lt;Context docBase="/usr/local/apache-solr/dist/apache-solr-1.3.0.war" debug="0" crossContext="true" &gt;
   &lt;Environment name="solr/home" type="java.lang.String" value="/usr/local/apache-solr/example/solr" override="true" /&gt;
&lt;/Context&gt;
				
				</pre>
			</li></ol></div>
	</div>
	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="solr.php"></a>22.6.4. solr-php-client</h3></div></div></div>
		
		<p>http://code.google.com/p/solr-php-client/</p>
		<pre class="screen">
wget http://solr-php-client.googlecode.com/files/SolrPhpClient.2009-03-11.tgz
tar zxvf SolrPhpClient.2009-03-11.tgz
sudo mv SolrPhpClient/Apache /usr/share/php/
		</pre>
	</div>
	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="solr.multicore"></a>22.6.5. multicore</h3></div></div></div>
		
		<p>solr.xml</p>
		<pre class="screen">
		
vim /usr/local/apache-solr/example/multicore/solr.xml

&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;solr persistent="false"&gt;
  &lt;cores adminPath="/admin/cores"&gt;
    &lt;core name="core0" instanceDir="core0" /&gt;
    &lt;core name="core1" instanceDir="core1" /&gt;

    &lt;core name="article" instanceDir="article" /&gt;

  &lt;/cores&gt;
&lt;/solr&gt;
		
		</pre>
		<p>core directory and config file</p>
		<pre class="screen">
		
mkdir -p article/conf

vim article/conf/solrconfig.xml

&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;config&gt;
  &lt;updateHandler class="solr.DirectUpdateHandler2" /&gt;
  &lt;requestDispatcher handleSelect="true" &gt;
    &lt;requestParsers enableRemoteStreaming="false" multipartUploadLimitInKB="2048" /&gt;
  &lt;/requestDispatcher&gt;
  &lt;requestHandler name="standard" class="solr.StandardRequestHandler" default="true" /&gt;
  &lt;requestHandler name="/update" class="solr.XmlUpdateRequestHandler" /&gt;
  &lt;requestHandler name="/admin/" class="org.apache.solr.handler.admin.AdminHandlers" /&gt;
  &lt;admin&gt;
    &lt;defaultQuery&gt;solr&lt;/defaultQuery&gt;
  &lt;/admin&gt;
&lt;/config&gt;

vim article/conf/schema.xml

&lt;?xml version="1.0" ?&gt;
&lt;schema name="example core zero" version="1.1"&gt;
  &lt;types&gt;
   &lt;fieldType name="sint" class="solr.SortableIntField" sortMissingLast="true" omitNorms="true"/&gt;
   &lt;fieldtype name="string"  class="solr.StrField" sortMissingLast="true" omitNorms="true"/&gt;
   &lt;fieldType name="date" class="solr.DateField" sortMissingLast="true" omitNorms="true"/&gt;
   &lt;fieldType name="text" class="solr.TextField" positionIncrementGap="100" /&gt;
  &lt;/types&gt;
 &lt;fields&gt;
  &lt;!-- general --&gt;
  &lt;field name="id"      type="sint"   indexed="true"  stored="true"  multiValued="false" required="true"/&gt;
  &lt;field name="type"    type="string"   indexed="true"  stored="true"  multiValued="false" /&gt;
  &lt;field name="name"    type="string"   indexed="true"  stored="true"  multiValued="false" /&gt;
  &lt;field name="title"   type="string"   indexed="true"  stored="true"  multiValued="false" /&gt;
  &lt;field name="content"   type="text"   indexed="true"  stored="true"  multiValued="false" /&gt;
  &lt;field name="timestamp" type="date" indexed="true" stored="true" default="NOW"/&gt;
 &lt;/fields&gt;
 &lt;!-- field to use to determine and enforce document uniqueness. --&gt;
 &lt;uniqueKey&gt;id&lt;/uniqueKey&gt;
 &lt;!-- field for the QueryParser to use when an explicit fieldname is absent --&gt;
 &lt;defaultSearchField&gt;content&lt;/defaultSearchField&gt;
 &lt;!-- SolrQueryParser configuration: defaultOperator="AND|OR" --&gt;
 &lt;solrQueryParser defaultOperator="OR"/&gt;
	&lt;copyField source="title" dest="content"/&gt;
	&lt;copyField source="name" dest="content"/&gt;
&lt;/schema&gt;
		
		</pre>
		<p>commit datas</p>
		<pre class="screen">
		
vim test.xml

&lt;add&gt;
	&lt;doc&gt;
	  &lt;field name="id"&gt;1&lt;/field&gt;
	  &lt;field name="name"&gt;Hello world&lt;/field&gt;
	&lt;/doc&gt;

	&lt;doc&gt;
	  &lt;field name="id"&gt;2&lt;/field&gt;
	  &lt;field name="title"&gt;Title Hello world&lt;/field&gt;
	&lt;/doc&gt;

	&lt;doc&gt;
	  &lt;field name="id"&gt;3&lt;/field&gt;
	  &lt;field name="name"&gt;Hello world 1&lt;/field&gt;
	  &lt;field name="content"&gt;Content 1&lt;/field&gt;
	&lt;/doc&gt;

	&lt;doc&gt;
	  &lt;field name="id"&gt;4&lt;/field&gt;
	  &lt;field name="name"&gt;Name Neo&lt;/field&gt;
	&lt;/doc&gt;

	&lt;doc&gt;
	  &lt;field name="id"&gt;5&lt;/field&gt;
	  &lt;field name="name"&gt;Last Chan&lt;/field&gt;
	&lt;/doc&gt;
&lt;/add&gt;


java -Durl=http://localhost:8983/solr/article/update -Dcommit=yes -jar ../exampledocs/post.jar test.xml

		
		</pre>
	</div>
	<div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="solr.analyzer"></a>22.6.6. 中文分词</h3></div></div></div>
		
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp101"></a>22.6.6.1. ChineseTokenizerFactory</h4></div></div></div>
			
			<pre class="screen">
			
&lt;fieldType name="text" class="solr.TextField" &gt;
    &lt;analyzer&gt;
        &lt;tokenizer class="org.apache.solr.analysis.ChineseTokenizerFactory"/&gt;
    &lt;/analyzer&gt;
&lt;/fieldType&gt;
			
			</pre>
		</div>

		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp102"></a>22.6.6.2. CJK</h4></div></div></div>
			
			<pre class="screen">
			
&lt;fieldType name="text" class="solr.TextField" positionIncrementGap="100"&gt;
	&lt;analyzer&gt;
    	&lt;tokenizer class="solr.CJKTokenizerFactory"/&gt;
	&lt;/analyzer&gt;
&lt;/fieldType&gt;
			
			</pre>
		</div>

		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp103"></a>22.6.6.3. mmseg4j</h4></div></div></div>
			
			<p>http://code.google.com/p/mmseg4j/</p>
			<p>install</p>
			<pre class="screen">
			
$ cd /usr/local/src/
$ wget http://mmseg4j.googlecode.com/files/mmseg4j-1.7.2.zip
$ unzip mmseg4j-1.7.2.zip
$ mkdir /usr/local/apache-solr/example/multicore/lib
$ cp /usr/local/src/mmseg4j-1.7.2/mmseg4j-all-1.7.2.jar /usr/local/apache-solr/example/multicore/lib
$ cd mmseg4j-1.7.2/
			
			</pre>
			<p>test</p>
			<pre class="screen">
$ java -Dmmseg.dic.path=/usr/local/apache-solr/example/solr -jar mmseg4j-all-1.7.2.jar 这里是字符串
$ java -Dmmseg.dic.path=/usr/local/apache-solr/example/solr -cp .:mmseg4j-all-1.7.2.jar com.chenlb.mmseg4j.example.Simple 这里是字符串
$ java -Dmmseg.dic.path=/usr/local/apache-solr/example/solr -cp .:mmseg4j-all-1.7.2.jar com.chenlb.mmseg4j.example.MaxWord 这里是字符串
			</pre>
			<p>mmseg4j 在 solr 中主要支持两个参数：mode、dicPath。mode 表示是什么模式分词（有效值：simplex、complex、max-word，如果输入了无效的默认用 max-word。）。dicPath 是词库目录可以是绝对目录，也可以是相对目录（是相对 solr.home 目录下的，dic 就会在 solr.home/dic 目录下找词库文件），如果不指定就是默认在 CWD/data 目录（程序运行当前目录的data子目录）下找。</p>
			<p>分词例子</p>
			<pre class="screen">
			
&lt;fieldtype name="textComplex" class="solr.TextField"&gt;
	&lt;analyzer&gt;
		&lt;tokenizer class="com.chenlb.mmseg4j.solr.MMSegTokenizerFactory"
			mode="complex" dicPath="dic"&gt;
		&lt;/tokenizer&gt;
	&lt;/analyzer&gt;
&lt;/fieldtype&gt;

&lt;fieldtype name="textMaxWord" class="solr.TextField"&gt;
	&lt;analyzer&gt;
		&lt;tokenizer class="com.chenlb.mmseg4j.solr.MMSegTokenizerFactory"
			mode="max-word" dicPath="dic"&gt;
		&lt;/tokenizer&gt;
	&lt;/analyzer&gt;
&lt;/fieldtype&gt;

&lt;fieldtype name="textSimple" class="solr.TextField"&gt;
	&lt;analyzer&gt;
		&lt;tokenizer class="com.chenlb.mmseg4j.solr.MMSegTokenizerFactory"
			mode="simple" dicPath="/usr/local/apache-solr/example/solr/my_dic"&gt;
		&lt;/tokenizer&gt;
	&lt;/analyzer&gt;
&lt;/fieldtype&gt;
			
			</pre>
			<p>添加到schema.xml</p>
			<pre class="screen">
			
&lt;fieldType name="text" class="solr.TextField" positionIncrementGap="100" &gt;
    &lt;analyzer&gt;
        &lt;tokenizer class="com.chenlb.mmseg4j.solr.MMSegTokenizerFactory" mode="complex" dicPath="dic"/&gt;
        &lt;filter class="solr.LowerCaseFilterFactory"/&gt;
    &lt;/analyzer&gt;
&lt;/fieldType&gt;
			
			</pre>
			<p>http://localhost:8080/solr/admin/analysis.jsp 在 Field 的下拉菜单选择 name，然后在应用输入 complex。可以看 mmseg4j 的分词的结果.</p>
		</div>
		<div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp104"></a>22.6.6.4. 中文分词“庖丁解牛” Paoding Analysis</h4></div></div></div>
			
			<pre class="screen">
$ cd /usr/local/src/
$ mkdir paoding-analysis-2.0.4-beta
$ cd paoding-analysis-2.0.4-beta/
$ wget http://paoding.googlecode.com/files/paoding-analysis-2.0.4-beta.zip
$ unzip paoding-analysis-2.0.4-beta.zip
$ cp paoding-analysis.jar /usr/local/apache-solr/example/multicore/lib/
			</pre>
			<p>ChineseTokenizerFactory</p>
			<pre class="screen">
			</pre>
		</div>
	</div>
</div><div xmlns="" id="disqus_thread"></div><script xmlns="">

var disqus_config = function () {
this.page.url = "http://www.netkiller.cn";  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = 'netkiller'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = '//netkiller.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script><noscript xmlns="">Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><br xmlns="" /><script xmlns="" type="text/javascript" id="clustrmaps" src="//cdn.clustrmaps.com/map_v2.js?u=r5HG&amp;d=9mi5r_kkDC8uxG8HuY3p4-2qgeeVypAK9vMD-2P6BYM"></script><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="../faq.html">上一页</a> </td><td width="20%" align="center"><a accesskey="u" href="../index.html">上一级</a></td><td width="40%" align="right"> <a accesskey="n" href="../../elasticsearch/index.html">下一页</a></td></tr><tr><td width="40%" align="left" valign="top">22.5. FAQ </td><td width="20%" align="center"><a accesskey="h" href="../../../index.html">起始页</a></td><td width="40%" align="right" valign="top"> 第 23 章 Elasticsearch</td></tr></table></div><script xmlns="">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-11694057-1', 'auto');
  ga('send', 'pageview');

</script><script xmlns="" async="async">
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?93967759a51cda79e49bf4e34d0b0f2c";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script xmlns="" async="async">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script><script xmlns="" type="text/javascript" src="/js/q.js" async="async"></script></body></html>